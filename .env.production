# DailyUse 生产环境配置
# =============================================================================
# 
# 📌 环境变量加载优先级机制
# ==========================================
# 本文件在 NODE_ENV=production 时加载，并根据以下优先级覆盖 .env 中的值：
# 
#   1️⃣  .env（基础共享配置）
#   2️⃣  .env.production（本文件 ← 生产特定非敏感配置）
#   3️⃣  .env.local（本地开发覆盖，不提交 Git）
#   4️⃣  .env.production.local（⭐ 生产敏感信息，不提交 Git）
#   5️⃣  操作系统环境变量（最高优先级）
# 
# 详细说明见：docs/deployment/ENV_LOADING_MECHANISM.md
# 
# ==========================================
# 安全建议
# ==========================================
# 
# ✅ 应该做：
#    - 在本文件中放非敏感配置（LOG_LEVEL, API_PORT 等）
#    - 在 .env.production.local 中放敏感配置（密码、密钥）
#    - 在服务器上创建 .env.production.local，权限设为 600
#    - 在 .gitignore 中包含 .env.production.local
# 
# ❌ 不要做：
#    - 不要在本文件中放密码、密钥
#    - 不要把 .env.production.local 提交到 Git
#    - 不要使用简单密码或默认密钥
#    - 不要在日志或错误消息中打印敏感信息
# 
# =============================================================================

NODE_ENV=production
API_PORT=3000
API_HOST=0.0.0.0
LOG_LEVEL=info
TZ=Asia/Shanghai

# =============================================================================
# 数据库配置（PostgreSQL）
# =============================================================================
# ✅ 使用分解配置（Docker 最佳实践）
# 
# 原因：
#   1. Docker Compose 中可以直接使用这些变量替换 ${DB_HOST} 等
#   2. PostgreSQL 和 API 容器可以共用这些配置
#   3. 无需处理密码中的特殊字符
#   4. 更易于维护和调试
#
# 敏感信息（DB_PASSWORD）必须在 .env.production.local 中设置！
# =============================================================================

POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=dailyuse
POSTGRES_USER=postgres
# POSTGRES_PASSWORD=    # ⚠️ 必须在 .env.production.local 中设置！

# API 应用使用相同的配置
DB_HOST=postgres        # Docker 网络中的服务名
DB_PORT=5432
DB_NAME=dailyuse
DB_USER=postgres
# DB_PASSWORD=          # ⚠️ 必须在 .env.production.local 中设置！

# =============================================================================
# Redis 配置
# =============================================================================
# REDIS_PASSWORD 必须在 .env.production.local 中设置！
# =============================================================================

REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
# REDIS_PASSWORD=      # ⚠️ 必须在 .env.production.local 中设置！

# =============================================================================
# JWT 认证配置
# =============================================================================
# JWT_SECRET 和 REFRESH_TOKEN_SECRET 必须在 .env.production.local 中设置！
# 
# 生成强密钥的方法：
#   openssl rand -base64 32
# 
# 在 .env.production.local 中添加：
#   JWT_SECRET=abc123def456...（至少 32 个字符）
#   REFRESH_TOKEN_SECRET=xyz789...（至少 32 个字符）
# =============================================================================

JWT_EXPIRES_IN=7d
JWT_REFRESH_EXPIRES_IN=30d
# JWT_SECRET=          # ⚠️ 必须在 .env.production.local 中设置！
# REFRESH_TOKEN_SECRET=# ⚠️ 必须在 .env.production.local 中设置！

# =============================================================================
# CORS 跨域配置（生产环境必须设置具体域名！）
# =============================================================================
# ❌ 不要使用 CORS_ORIGIN=* 在生产环境！
# 
# 在 .env.production.local 中设置：
#   CORS_ORIGIN=https://yourdomain.com,https://www.yourdomain.com
# =============================================================================

# CORS_ORIGIN=https://yourdomain.com      # ⚠️ 在 .env.production.local 中覆盖！
CORS_CREDENTIALS=true

# =============================================================================
# 功能开关
# =============================================================================

ENABLE_DAILY_ANALYSIS=true
USE_PRIORITY_QUEUE_SCHEDULER=true

# =============================================================================
# 文件上传配置
# =============================================================================

UPLOAD_MAX_SIZE=10485760    # 10MB

# =============================================================================
# 可选：第三方服务配置
# =============================================================================
# 这些都是可选的，在 .env.production.local 中按需配置

# 错误追踪（Sentry）
# SENTRY_DSN=https://xxx@sentry.io/xxx

# 邮件服务（SMTP）
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=noreply@yourdomain.com
# SMTP_PASSWORD=app-specific-password
# SMTP_FROM=DailyUse <noreply@yourdomain.com>

# AI 服务（OpenAI）
# OPENAI_API_KEY=sk-...
# OPENAI_MODEL=gpt-4

# =============================================================================
# ⚡️ 快速开始
# =============================================================================
# 
# 1. 在生产服务器上创建 .env.production.local：
#    
#    cat > /opt/dailyuse/.env.production.local << 'EOF'
#    POSTGRES_PASSWORD=生成的强密码
#    DATABASE_URL=postgresql://postgres:生成的强密码@postgres:5432/dailyuse
#    REDIS_PASSWORD=生成的强密码
#    JWT_SECRET=生成的强密钥
#    REFRESH_TOKEN_SECRET=生成的强密钥
#    CORS_ORIGIN=https://yourdomain.com,https://www.yourdomain.com
#    EOF
#    
#    chmod 600 /opt/dailyuse/.env.production.local
# 
# 2. 生成强密码的方法：
#    openssl rand -base64 32
# 
# 3. 启动应用：
#    docker-compose -f docker-compose.prod.yml up -d
# 
# 4. 验证配置：
#    docker-compose logs api | head -20
#    应该看到：✅ Environment variables validated successfully
# 
# 详细说明见：docs/deployment/ENV_LOADING_MECHANISM.md
# =============================================================================
