# DailyUse 生产环境配置
# =============================================================================
# 
# 📌 环境变量加载优先级机制
# ==========================================
# 本文件在 NODE_ENV=production 时加载，并根据以下优先级覆盖 .env 中的值：
# 
#   1️⃣  .env（基础共享配置）
#   2️⃣  .env.production（本文件 ← 生产特定非敏感配置）
#   3️⃣  .env.local（本地开发覆盖，不提交 Git）
#   4️⃣  .env.production.local（⭐ 生产敏感信息，不提交 Git）
#   5️⃣  操作系统环境变量（最高优先级）
# 
# 详细说明见：docs/deployment/ENV_LOADING_MECHANISM.md
# 
# ==========================================
# 安全建议
# ==========================================
# 
# ✅ 应该做：
#    - 在本文件中放非敏感配置（LOG_LEVEL, API_PORT 等）
#    - 在 .env.production.local 中放敏感配置（密码、密钥）
#    - 在服务器上创建 .env.production.local，权限设为 600
#    - 在 .gitignore 中包含 .env.production.local
# 
# ❌ 不要做：
#    - 不要在本文件中放密码、密钥
#    - 不要把 .env.production.local 提交到 Git
#    - 不要使用简单密码或默认密钥
#    - 不要在日志或错误消息中打印敏感信息
# 
# =============================================================================

# =============================================================================
# 1️⃣  应用基础配置
# =============================================================================
NODE_ENV=production
API_PORT=3000
API_HOST=0.0.0.0
LOG_LEVEL=warn                          # 生产环境使用 warn 级别减少日志量
TZ=Asia/Shanghai
APP_NAME=DailyUse
APP_VERSION=0.1.0

# =============================================================================
# 2️⃣  Docker 镜像配置
# =============================================================================
REGISTRY=docker.io
IMAGE_NAMESPACE=dailyuse
API_TAG=v1.0.3
WEB_TAG=v1.0.1

# =============================================================================
# 3️⃣  数据库配置（PostgreSQL）
# =============================================================================
# ✅ 使用分解配置（Docker 最佳实践）
# 
# 应用的处理逻辑：
#   1. 如果提供了 DATABASE_URL，则直接使用
#   2. 否则从分解式配置（DB_HOST, DB_PORT 等）自动生成 DATABASE_URL
#   3. 应用自动拼接成：
#      postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}
# 
# Docker Compose 会使用服务名 postgres 作为主机名
# DB_PASSWORD 敏感信息必须在 .env.production.local 中设置！
# =============================================================================

DB_HOST=postgres                        # Docker 网络中的 PostgreSQL 服务名
DB_PORT=5432                            # PostgreSQL 默认端口
DB_NAME=dailyuse                        # 数据库名
DB_USER=postgres                        # 数据库用户
# DB_PASSWORD=                          # ⚠️ 必须在 .env.production.local 中设置！

# =============================================================================
# 4️⃣  Redis 缓存配置
# =============================================================================
# Docker Compose 会使用服务名 redis 作为主机名
# REDIS_PASSWORD 敏感信息必须在 .env.production.local 中设置！
# =============================================================================

REDIS_HOST=redis                        # Docker 网络中的 Redis 服务名
REDIS_PORT=6379                         # Redis 默认端口
REDIS_DB=0                              # Redis 数据库号
# REDIS_PASSWORD=                       # ⚠️ 必须在 .env.production.local 中设置！

# =============================================================================
# 5️⃣  JWT 认证配置
# =============================================================================
# 敏感信息（JWT_SECRET, REFRESH_TOKEN_SECRET）必须在 .env.production.local 中设置！
# 
# 生成强密钥的方法：
#   macOS/Linux:  openssl rand -base64 32
#   PowerShell:   [Convert]::ToBase64String([byte[]]$(1..32))
# =============================================================================

JWT_EXPIRES_IN=7d
JWT_REFRESH_EXPIRES_IN=30d
# JWT_SECRET=                           # ⚠️ 必须在 .env.production.local 中设置！
# REFRESH_TOKEN_SECRET=                 # ⚠️ 必须在 .env.production.local 中设置！

# =============================================================================
# 6️⃣  CORS 跨域配置
# =============================================================================
# ⚠️  生产环境必须设置具体域名，不能使用 *！
# 
# 在 .env.production.local 中设置：
#   CORS_ORIGIN=https://yourdomain.com,https://www.yourdomain.com
# =============================================================================

# CORS_ORIGIN=                          # ⚠️ 在 .env.production.local 中设置！
CORS_CREDENTIALS=true                   # 是否允许发送凭证（cookies）

# =============================================================================
# 7️⃣  Web 前端配置
# =============================================================================
WEB_PORT=8080
VITE_API_BASE_URL=/api/v1               # 相对路径，由 Nginx 反向代理
# VITE_API_URL=                         # 生产环境不需要（已在构建时设置）
APP_DOMAIN=dailyuse.bakersean.top
API_DOMAIN=api.dailyuse.bakersean.top

# =============================================================================
# 8️⃣  文件上传配置
# =============================================================================
UPLOAD_MAX_SIZE=10485760                # 10MB

# =============================================================================
# 9️⃣  功能开关
# =============================================================================
ENABLE_DAILY_ANALYSIS=true              # 启用日常分析
USE_PRIORITY_QUEUE_SCHEDULER=true       # 使用优先级队列调度器

# =============================================================================
# 🔟 可选：第三方服务配置
# =============================================================================
# 这些都是可选的，按需在 .env.production.local 中配置

# 错误追踪（Sentry）
# SENTRY_DSN=https://xxx@sentry.io/xxx

# 邮件服务（SMTP）
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=noreply@yourdomain.com
# SMTP_PASS=app-specific-password
# SMTP_FROM=DailyUse <noreply@yourdomain.com>

# AI 服务（OpenAI）
# OPENAI_API_KEY=sk-...
# OPENAI_MODEL=gpt-4

# 阿里云 OSS（用户文件存储）
# ALIYUN_ACCESS_KEY_ID=xxx
# ALIYUN_ACCESS_KEY_SECRET=xxx
# ALIYUN_OSS_BUCKET=xxx
# ALIYUN_OSS_REGION=oss-cn-hangzhou

# =============================================================================
# 1️⃣1️⃣ 快速部署检查清单
# =============================================================================
# 
# 在生产服务器上运行以下步骤：
#
# 1️⃣  创建 .env.production.local（包含所有敏感信息）：
#    
#    cat > /opt/dailyuse/.env.production.local << 'EOF'
#    # 数据库
#    DB_PASSWORD=<生成的强密码>
#    
#    # Redis
#    REDIS_PASSWORD=<生成的强密码>
#    
#    # JWT
#    JWT_SECRET=<生成的强密钥>
#    REFRESH_TOKEN_SECRET=<生成的强密钥>
#    
#    # CORS（改为你的实际域名！）
#    CORS_ORIGIN=https://yourdomain.com,https://www.yourdomain.com
#    
#    # 邮件（如需启用）
#    # SMTP_HOST=smtp.gmail.com
#    # SMTP_PORT=587
#    # SMTP_USER=noreply@yourdomain.com
#    # SMTP_PASS=app-specific-password
#    EOF
#    
#    chmod 600 /opt/dailyuse/.env.production.local
# 
# 2️⃣  生成强密钥：
#    openssl rand -base64 32
# 
# 3️⃣  启动应用：
#    docker-compose -f docker-compose.prod.yml up -d
# 
# 4️⃣  验证配置（应该看到 ✅ 成功信息）：
#    docker-compose -f docker-compose.prod.yml logs api | head -50
# 
# 5️⃣  检查服务状态：
#    docker-compose -f docker-compose.prod.yml ps
# 
# =============================================================================
# 
# 详细说明见：docs/deployment/ENV_LOADING_MECHANISM.md
# =============================================================================
