# Authentication E2E æµ‹è¯•æŒ‡å—

## ğŸ“‹ æµ‹è¯•æ–‡ä»¶æ¦‚è§ˆ

### 1. `auth-login-debug.spec.ts` - ç™»å½•è°ƒè¯•æµ‹è¯• ğŸ”
**ç”¨é€”**: ä¸“é—¨ç”¨äºè°ƒè¯•ç™»å½•é—®é¢˜ï¼ŒåŒ…å«è¯¦ç»†æ—¥å¿—å’Œæˆªå›¾

**ç‰¹ç‚¹**:
- âœ… è¯¦ç»†çš„æ­¥éª¤æ—¥å¿—ï¼ˆå…± 10 ä¸ªæ­¥éª¤ï¼‰
- âœ… è‡ªåŠ¨æˆªå›¾ä¿å­˜åˆ° `/tmp/`
- âœ… ç½‘ç»œè¯·æ±‚/å“åº”æ‹¦æˆªå’Œæ—¥å¿—
- âœ… æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯æ•è·
- âœ… å¤šç§å®šä½ç­–ç•¥å°è¯•

**ä½•æ—¶ä½¿ç”¨**: 
- ç™»å½•åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œæ—¶
- éœ€è¦æ’æŸ¥ç™»å½•æµç¨‹ä¸­çš„å…·ä½“é—®é¢˜
- éœ€è¦æŸ¥çœ‹è¯¦ç»†çš„ç½‘ç»œè¯·æ±‚å’Œå“åº”

**è¿è¡Œæ–¹å¼**:
```bash
# å•ç‹¬è¿è¡Œè°ƒè¯•æµ‹è¯•
npx playwright test authentication/auth-login-debug.spec.ts --headed

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
npx playwright test authentication/auth-login-debug.spec.ts --headed --reporter=list

# æŸ¥çœ‹ç”Ÿæˆçš„æˆªå›¾
ls -lh /tmp/*-*.png
```

**ç”Ÿæˆçš„æˆªå›¾**:
- `01-login-page-loaded.png` - ç™»å½•é¡µé¢åŠ è½½å®Œæˆ
- `02-login-tab-selected.png` - ç™»å½•æ ‡ç­¾å·²é€‰ä¸­
- `03-error-no-username-input.png` - é”™è¯¯ï¼šæ‰¾ä¸åˆ°ç”¨æˆ·åè¾“å…¥æ¡†
- `04-username-filled.png` - ç”¨æˆ·åå·²å¡«å†™
- `05-error-no-password-input.png` - é”™è¯¯ï¼šæ‰¾ä¸åˆ°å¯†ç è¾“å…¥æ¡†
- `06-password-filled.png` - å¯†ç å·²å¡«å†™
- `07-error-no-login-button.png` - é”™è¯¯ï¼šæ‰¾ä¸åˆ°ç™»å½•æŒ‰é’®
- `08-after-login-click.png` - ç‚¹å‡»ç™»å½•æŒ‰é’®å
- `09-login-error.png` - ç™»å½•é”™è¯¯æç¤º
- `10-final-state.png` - æœ€ç»ˆçŠ¶æ€

---

### 2. `auth-flow.spec.ts` - å®Œæ•´è®¤è¯æµç¨‹æµ‹è¯• ğŸ¯
**ç”¨é€”**: æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç”Ÿå‘½å‘¨æœŸ

**æµ‹è¯•ç”¨ä¾‹**:
1. **[P0] å®Œæ•´æµç¨‹ï¼šæ³¨å†Œ â†’ ç™»å½• â†’ ç™»å‡º â†’ å†æ¬¡ç™»å½•**
   - æµ‹è¯•ç”¨æˆ·å®Œæ•´çš„è®¤è¯ç”Ÿå‘½å‘¨æœŸ
   - éªŒè¯æ¯ä¸ªæ­¥éª¤éƒ½èƒ½æ­£å¸¸å·¥ä½œ
   
2. **[P0] æ³¨å†Œï¼šåº”è¯¥æˆåŠŸæ³¨å†Œæ–°ç”¨æˆ·**
   - æµ‹è¯•æ–°ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
   - æ¯æ¬¡è¿è¡Œä½¿ç”¨å”¯ä¸€çš„ç”¨æˆ·åå’Œé‚®ç®±
   
3. **[P0] ç™»å½•ï¼šåº”è¯¥æ‹’ç»é”™è¯¯çš„å¯†ç **
   - æµ‹è¯•å¯†ç éªŒè¯
   - éªŒè¯é”™è¯¯æç¤ºæ˜¾ç¤ºæ­£ç¡®
   
4. **[P1] ç™»å½•ï¼šåº”è¯¥æ‹’ç»ä¸å­˜åœ¨çš„ç”¨æˆ·**
   - æµ‹è¯•ç”¨æˆ·åéªŒè¯
   - éªŒè¯é”™è¯¯å¤„ç†
   
5. **[P1] æ³¨å†Œï¼šåº”è¯¥æ‹’ç»é‡å¤çš„ç”¨æˆ·å**
   - æµ‹è¯•ç”¨æˆ·åå”¯ä¸€æ€§éªŒè¯
   - éªŒè¯é”™è¯¯æç¤º
   
6. **[P2] ç™»å½•ï¼šåº”è¯¥æ”¯æŒè®°ä½å¯†ç **
   - æµ‹è¯•"è®°ä½å¯†ç "åŠŸèƒ½
   - éªŒè¯æœ¬åœ°å­˜å‚¨

**è¿è¡Œæ–¹å¼**:
```bash
# è¿è¡Œæ‰€æœ‰è®¤è¯æµç¨‹æµ‹è¯•
npx playwright test authentication/auth-flow.spec.ts

# åªè¿è¡Œ P0 çº§åˆ«æµ‹è¯•
npx playwright test authentication/auth-flow.spec.ts -g "P0"

# åªè¿è¡Œç‰¹å®šæµ‹è¯•
npx playwright test authentication/auth-flow.spec.ts -g "å®Œæ•´æµç¨‹"
```

---

### 3. `account-management.spec.ts` - è´¦æˆ·ç®¡ç†æµ‹è¯• ğŸ‘¤
**ç”¨é€”**: æµ‹è¯•è´¦æˆ·ç›¸å…³çš„ç®¡ç†åŠŸèƒ½

**æµ‹è¯•ç”¨ä¾‹**:
1. **[P1] åº”è¯¥èƒ½å¤ŸæŸ¥çœ‹ä¸ªäººèµ„æ–™**
   - éªŒè¯ä¸ªäººèµ„æ–™é¡µé¢æ˜¾ç¤ºæ­£ç¡®
   
2. **[P1] åº”è¯¥èƒ½å¤Ÿä¿®æ”¹ä¸ªäººèµ„æ–™**
   - æµ‹è¯•æ˜µç§°ç­‰ä¿¡æ¯ä¿®æ”¹
   
3. **[P2] åº”è¯¥èƒ½å¤Ÿä¿®æ”¹å¯†ç **
   - æµ‹è¯•å¯†ç ä¿®æ”¹æµç¨‹
   
4. **[P0] åº”è¯¥èƒ½å¤Ÿç™»å‡ºè´¦æˆ·**
   - æµ‹è¯•ç™»å‡ºåŠŸèƒ½
   - éªŒè¯è·³è½¬å’Œ token æ¸…ç†
   
5. **[P2] ç™»å‡ºååº”è¯¥æ¸…é™¤æ‰€æœ‰è®¤è¯ä¿¡æ¯**
   - éªŒè¯æ‰€æœ‰è®¤è¯ç›¸å…³æ•°æ®è¢«æ¸…é™¤

**è¿è¡Œæ–¹å¼**:
```bash
# è¿è¡Œæ‰€æœ‰è´¦æˆ·ç®¡ç†æµ‹è¯•
npx playwright test account/account-management.spec.ts

# åªè¿è¡Œç™»å‡ºæµ‹è¯•
npx playwright test account/account-management.spec.ts -g "ç™»å‡º"
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

1. **ç¡®ä¿æµ‹è¯•ç”¨æˆ·å·²åˆ›å»º**:
```bash
pnpm test:seed
```

2. **ç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œ**:
```bash
# åœ¨ä¸€ä¸ªç»ˆç«¯ä¸­å¯åŠ¨ API æœåŠ¡
cd apps/api
pnpm dev

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­å¯åŠ¨ Web æœåŠ¡
cd apps/web
pnpm dev
```

3. **éªŒè¯æœåŠ¡çŠ¶æ€**:
```bash
# æµ‹è¯• API å­˜æ´»æ£€æŸ¥
curl http://localhost:3888/healthz && echo " âœ… API å­˜æ´»"

# æµ‹è¯• API å°±ç»ªæ£€æŸ¥ï¼ˆåŒ…å«æ•°æ®åº“æ£€æŸ¥ï¼‰
curl http://localhost:3888/readyz && echo " âœ… API å°±ç»ª"

# æµ‹è¯• Web æœåŠ¡
curl http://localhost:5173 && echo " âœ… Web æ­£å¸¸"
```

---

## ğŸ“Š æµ‹è¯•ä¼˜å…ˆçº§è¯´æ˜

- **[P0]** - æ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»é€šè¿‡ï¼Œé˜»å¡å‘å¸ƒ
- **[P1]** - é‡è¦åŠŸèƒ½ï¼Œåº”è¯¥é€šè¿‡ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ
- **[P2]** - æ¬¡è¦åŠŸèƒ½ï¼Œæœ€å¥½é€šè¿‡ï¼Œä¼˜åŒ–é¡¹

---

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: æµ‹è¯•æ‰¾ä¸åˆ°ç”¨æˆ·åè¾“å…¥æ¡†

**åŸå› **: v-combobox ç»„ä»¶çš„ DOM ç»“æ„ç‰¹æ®Š

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨è°ƒè¯•æµ‹è¯•æŸ¥çœ‹å®é™…çš„ DOM ç»“æ„
```bash
npx playwright test authentication/auth-login-debug.spec.ts --headed
```

æŸ¥çœ‹æˆªå›¾ `03-error-no-username-input.png` å’Œæ§åˆ¶å°æ—¥å¿—

---

### é—®é¢˜ 2: ç™»å½• API è¯·æ±‚æœªå‘é€

**å¯èƒ½åŸå› **:
1. API æœåŠ¡æœªå¯åŠ¨
2. CORS é…ç½®é”™è¯¯
3. ç™»å½•æŒ‰é’®æœªæ­£ç¡®è§¦å‘

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥ API æœåŠ¡
curl http://localhost:3888/healthz

# 2. è¿è¡Œè°ƒè¯•æµ‹è¯•æŸ¥çœ‹ç½‘ç»œæ—¥å¿—
npx playwright test authentication/auth-login-debug.spec.ts --headed --reporter=list

# 3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ï¼ˆè°ƒè¯•æµ‹è¯•ä¼šè¾“å‡ºï¼‰
```

---

### é—®é¢˜ 3: ç™»å½•æˆåŠŸä½†æµ‹è¯•å¤±è´¥

**å¯èƒ½åŸå› **:
1. è·¯ç”±è·³è½¬å»¶è¿Ÿ
2. localStorage å­˜å‚¨å»¶è¿Ÿ
3. æ–­è¨€æ¡ä»¶ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**: å¢åŠ ç­‰å¾…æ—¶é—´æˆ–ä½¿ç”¨é‡è¯•æœºåˆ¶
```typescript
// åœ¨æµ‹è¯•ä¸­ä½¿ç”¨æ›´é•¿çš„è¶…æ—¶
await page.waitForURL(
  (url) => !url.pathname.includes(WEB_CONFIG.LOGIN_PATH),
  { timeout: 15000 }
);
```

---

### é—®é¢˜ 4: æµ‹è¯•ç”¨æˆ·ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯**: "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°åˆ›å»ºæµ‹è¯•ç”¨æˆ·
pnpm test:seed

# æ£€æŸ¥æ•°æ®åº“ä¸­çš„æµ‹è¯•ç”¨æˆ·
psql your_database -c "SELECT username, email FROM users WHERE username LIKE 'test%';"
```

---

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Š

### ç”Ÿæˆ HTML æŠ¥å‘Š
```bash
npx playwright test authentication/ --reporter=html
npx playwright show-report
```

### ç”Ÿæˆ JSON æŠ¥å‘Š
```bash
npx playwright test authentication/ --reporter=json > report.json
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æµ‹è¯•éš”ç¦»
- æ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„ç”¨æˆ·ï¼ˆ`auth-flow.spec.ts`ï¼‰
- æˆ–ä½¿ç”¨å›ºå®šçš„æµ‹è¯•ç”¨æˆ·ï¼ˆ`account-management.spec.ts`ï¼‰
- æ¯ä¸ªæµ‹è¯•å‰æ¸…ç†è®¤è¯çŠ¶æ€

### 2. é”™è¯¯å¤„ç†
- ä½¿ç”¨ try-catch å¤„ç†å¯é€‰å…ƒç´ 
- æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- æˆªå›¾ä¿å­˜å¤±è´¥çŠ¶æ€

### 3. ç­‰å¾…ç­–ç•¥
- ä½¿ç”¨ `waitForLoadState('networkidle')` ç­‰å¾…ç½‘ç»œè¯·æ±‚
- ä½¿ç”¨ `waitForURL()` ç­‰å¾…è·¯ç”±è·³è½¬
- é¿å…ä½¿ç”¨å›ºå®šçš„ `waitForTimeout()`ï¼ˆé™¤éå¿…è¦ï¼‰

### 4. é€‰æ‹©å™¨ç­–ç•¥
- ä¼˜å…ˆä½¿ç”¨ `data-testid`
- å…¶æ¬¡ä½¿ç”¨è¯­ä¹‰åŒ–çš„ text å®šä½
- æœ€åä½¿ç”¨ CSS ç±»å
- æä¾›å¤šç§å¤‡é€‰ç­–ç•¥ï¼ˆè§ `auth-login-debug.spec.ts`ï¼‰

---

## ğŸ”„ æŒç»­é›†æˆ

### GitHub Actions ç¤ºä¾‹
```yaml
name: E2E Tests - Authentication

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: pnpm install
      - run: pnpm test:seed
      - run: pnpm -C apps/api dev &
      - run: pnpm -C apps/web dev &
      - run: npx playwright test authentication/
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜:

1. **æŸ¥çœ‹è°ƒè¯•æµ‹è¯•è¾“å‡º**:
   ```bash
   npx playwright test authentication/auth-login-debug.spec.ts --headed --reporter=list
   ```

2. **æŸ¥çœ‹æˆªå›¾**: æ£€æŸ¥ `/tmp/` ç›®å½•ä¸­çš„æˆªå›¾æ–‡ä»¶

3. **æŸ¥çœ‹é…ç½®**: ç¡®è®¤ `/apps/web/e2e/config.ts` ä¸­çš„é…ç½®æ­£ç¡®

4. **æŸ¥çœ‹æ–‡æ¡£**: é˜…è¯» `/apps/web/e2e/CONFIG_README.md`

---

## ğŸ“ æ›´æ–°æ—¥å¿—

- **2024-01-XX**: åˆ›å»ºè®¤è¯æµ‹è¯•å¥—ä»¶
  - æ·»åŠ ç™»å½•è°ƒè¯•æµ‹è¯•
  - æ·»åŠ å®Œæ•´è®¤è¯æµç¨‹æµ‹è¯•
  - æ·»åŠ è´¦æˆ·ç®¡ç†æµ‹è¯•
