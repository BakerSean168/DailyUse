# Goal Module E2E Tests

## ğŸ“‹ æµ‹è¯•å¥—ä»¶æ¦‚è§ˆ

Goalæ¨¡å—çš„ç«¯åˆ°ç«¯(E2E)æµ‹è¯•è¦†ç›–äº†æ‰€æœ‰å…³é”®ä¸šåŠ¡æµç¨‹,ç¡®ä¿ç”¨æˆ·ä½“éªŒçš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚

### æµ‹è¯•æ–‡ä»¶åˆ—è¡¨

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•æ•°é‡ | ä¼˜å…ˆçº§ | æè¿° |
|---------|---------|--------|------|
| `goal-crud.spec.ts` | 7 | P0-P2 | åŸºç¡€CRUDæ“ä½œ |
| `goal-keyresult.spec.ts` | 9 | P0-P2 | å…³é”®ç»“æœç®¡ç† |
| `goal-focus-mode.spec.ts` | 8 | P0-P2 | ä¸“æ³¨æ¨¡å¼åŠŸèƒ½ |
| `goal-statistics.spec.ts` | 11 | P0-P2 | ç»Ÿè®¡å’Œè¿›åº¦è¿½è¸ª |

**æ€»è®¡**: 35ä¸ªE2Eæµ‹è¯•ç”¨ä¾‹

---

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### 1. Goal CRUD (`goal-crud.spec.ts`)

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… åˆ›å»ºç›®æ ‡ (P0)
- âœ… æ›´æ–°ç›®æ ‡ä¿¡æ¯ (P0)
- âœ… åˆ é™¤ç›®æ ‡ (P0)
- âœ… æŸ¥çœ‹ç›®æ ‡è¯¦æƒ… (P1)
- âœ… æ¿€æ´»ç›®æ ‡ (P1)
- âœ… å®Œæˆç›®æ ‡ (P1)
- âœ… ç­›é€‰ç›®æ ‡ (P2)

**ä¸šåŠ¡åœºæ™¯**:
```typescript
// ç”¨æˆ·åˆ›å»ºæ–°ç›®æ ‡
åˆ›å»ºç›®æ ‡ â†’ å¡«å†™ä¿¡æ¯ â†’ ä¿å­˜ â†’ éªŒè¯æ˜¾ç¤º

// ç”¨æˆ·ç¼–è¾‘ç°æœ‰ç›®æ ‡
é€‰æ‹©ç›®æ ‡ â†’ ç¼–è¾‘ä¿¡æ¯ â†’ ä¿å­˜ â†’ éªŒè¯æ›´æ–°

// ç”¨æˆ·åˆ é™¤ç›®æ ‡
é€‰æ‹©ç›®æ ‡ â†’ åˆ é™¤ â†’ ç¡®è®¤ â†’ éªŒè¯æ¶ˆå¤±
```

---

### 2. KeyResult Management (`goal-keyresult.spec.ts`)

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… æ·»åŠ INCREMENTALç±»å‹å…³é”®ç»“æœ (P0)
- âœ… æ·»åŠ PERCENTAGEç±»å‹å…³é”®ç»“æœ (P0)
- âœ… æ·»åŠ BINARYç±»å‹å…³é”®ç»“æœ (P0)
- âœ… æ›´æ–°å…³é”®ç»“æœè¿›åº¦ (P0)
- âœ… å®Œæˆå…³é”®ç»“æœ (P0)
- âœ… åˆ é™¤å…³é”®ç»“æœ (P1)
- âœ… å¤šKRæ€»è¿›åº¦è®¡ç®— (P1)
- âœ… æƒé‡æ€»å’ŒéªŒè¯ (P2)

**ä¸šåŠ¡åœºæ™¯**:
```typescript
// OKRç®¡ç†æµç¨‹
åˆ›å»ºç›®æ ‡ â†’ æ·»åŠ å¤šä¸ªKR â†’ è®¾ç½®æƒé‡ â†’ æ›´æ–°è¿›åº¦ â†’ æŸ¥çœ‹æ€»è¿›åº¦

// æƒé‡åˆ†é…
KR1 (40%) + KR2 (30%) + KR3 (30%) = 100%
æ€»è¿›åº¦ = Î£(KRè¿›åº¦ Ã— æƒé‡)
```

**æµ‹è¯•äº®ç‚¹**:
- æ”¯æŒ3ç§KRç±»å‹: INCREMENTAL, PERCENTAGE, BINARY
- è‡ªåŠ¨è®¡ç®—åŠ æƒè¿›åº¦
- éªŒè¯æƒé‡æ€»å’Œä¸è¶…è¿‡100%

---

### 3. Focus Mode (`goal-focus-mode.spec.ts`)

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å¯ç”¨ä¸“æ³¨æ¨¡å¼ (P0)
- âœ… éšè—å…¶ä»–ç›®æ ‡ (P0)
- âœ… æ˜¾ç¤ºå€’è®¡æ—¶ (P0)
- âœ… å»¶é•¿ä¸“æ³¨æ—¶é—´ (P1)
- âœ… æ‰‹åŠ¨ç»“æŸä¸“æ³¨æ¨¡å¼ (P1)
- âœ… æŸ¥çœ‹å†å²è®°å½• (P1)
- âœ… è®°å½•ä¸“æ³¨æ—¶é—´ (P2)
- âœ… é˜»æ­¢é‡å¤å¯åŠ¨ (P2)

**ä¸šåŠ¡åœºæ™¯**:
```typescript
// ä¸“æ³¨å·¥ä½œæµç¨‹
é€‰æ‹©ç›®æ ‡ â†’ å¯åŠ¨ä¸“æ³¨æ¨¡å¼(30åˆ†é’Ÿ) â†’ éšè—å¹²æ‰° â†’ ä¸“å¿ƒå·¥ä½œ â†’ è®°å½•æ—¶é—´

// ä¸“æ³¨å†å²
å®Œæˆä¸“æ³¨ â†’ è®°å½•æ—¶é—´ â†’ æŸ¥çœ‹å†å² â†’ ç»Ÿè®¡æ€»ä¸“æ³¨æ—¶é•¿
```

**æµ‹è¯•äº®ç‚¹**:
- éªŒè¯å€’è®¡æ—¶åŠŸèƒ½
- æµ‹è¯•æ—¶é—´å»¶é•¿é€»è¾‘
- é˜²æ­¢å¹¶å‘ä¸“æ³¨å‘¨æœŸ
- å†å²è®°å½•è¿½è¸ª

---

### 4. Statistics & Progress Tracking (`goal-statistics.spec.ts`)

**æ ¸å¿ƒåŠŸèƒ½**:

#### ç»Ÿè®¡åŠŸèƒ½:
- âœ… æ˜¾ç¤ºç›®æ ‡æ€»æ•° (P0)
- âœ… æ˜¾ç¤ºæ´»è·ƒç›®æ ‡æ•° (P0)
- âœ… æ˜¾ç¤ºå·²å®Œæˆç›®æ ‡æ•° (P0)
- âœ… æ˜¾ç¤ºå®Œæˆç‡ (P1)
- âœ… æŒ‰é‡è¦æ€§åˆ†ç±»ç»Ÿè®¡ (P1)
- âœ… æœ¬å‘¨/æœ¬æœˆå®Œæˆæ•° (P1)
- âœ… è¿›åº¦è¶‹åŠ¿å›¾ (P2)

#### è¿›åº¦è¿½è¸ª:
- âœ… å®æ—¶æ˜¾ç¤ºæ€»è¿›åº¦ (P0)
- âœ… æ›´æ–°KRåè‡ªåŠ¨æ›´æ–° (P0)
- âœ… æ˜¾ç¤ºæ¯ä¸ªKRå®Œæˆåº¦ (P1)
- âœ… è¿›åº¦æ¡å¯è§†åŒ– (P1)

**ä¸šåŠ¡åœºæ™¯**:
```typescript
// ç»Ÿè®¡ä»ªè¡¨ç›˜
æ€»ç›®æ ‡: 15
æ´»è·ƒ: 8 | å®Œæˆ: 5 | å½’æ¡£: 2
å®Œæˆç‡: 33%

// å®æ—¶è¿›åº¦è¿½è¸ª
KR1 (40%): â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%
KR2 (30%): â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 60%
KR3 (30%): â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 40%
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 64%
```

**æµ‹è¯•äº®ç‚¹**:
- äº‹ä»¶é©±åŠ¨çš„ç»Ÿè®¡æ›´æ–°
- å®æ—¶è¿›åº¦è®¡ç®—
- å¯è§†åŒ–å›¾è¡¨éªŒè¯

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æµ‹è¯•æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Playwright Test Runner       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Test Specifications         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  CRUD    â”‚  â”‚KeyResult â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚FocusMode â”‚  â”‚Statisticsâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Helper Functions            â”‚
â”‚  - login()                          â”‚
â”‚  - createGoal()                     â”‚
â”‚  - addKeyResult()                   â”‚
â”‚  - openFocusMode()                  â”‚
â”‚  - viewStatistics()                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Real Web Application        â”‚
â”‚         (React + API)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é€‰æ‹©å™¨ç­–ç•¥

æµ‹è¯•ä½¿ç”¨å¤šå±‚åå¤‡é€‰æ‹©å™¨ç¡®ä¿ç¨³å®šæ€§:

```typescript
// ä¼˜å…ˆçº§: data-testid > æ–‡æœ¬ > nameå±æ€§
const button = page
  .locator('[data-testid="create-goal-button"]')
  .or(page.locator('button:has-text("åˆ›å»ºç›®æ ‡")'))
  .or(page.locator('button[name="create"]'));
```

**æ¨èUIå®ç°**:
```html
<!-- ä¸ºE2Eæµ‹è¯•æ·»åŠ data-testid -->
<button data-testid="create-goal-button">
  åˆ›å»ºç›®æ ‡
</button>

<input 
  data-testid="goal-title-input"
  name="title" 
  placeholder="ç›®æ ‡æ ‡é¢˜"
/>

<div data-testid="goal-progress">
  æ€»è¿›åº¦: 65%
</div>
```

---

## ğŸš€ è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰Goalæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰Goal E2Eæµ‹è¯•
npx playwright test apps/web/e2e/goal

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npx playwright test apps/web/e2e/goal/goal-crud.spec.ts

# è¿è¡Œå¸¦UIçš„æµ‹è¯•(è°ƒè¯•)
npx playwright test apps/web/e2e/goal --ui

# è¿è¡ŒæŒ‡å®šä¼˜å…ˆçº§
npx playwright test apps/web/e2e/goal -g "P0"
```

### è¿è¡Œå•ä¸ªæµ‹è¯•

```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•ç”¨ä¾‹
npx playwright test -g "åº”è¯¥æˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°ç›®æ ‡"

# è¿è¡ŒKeyResultç›¸å…³æµ‹è¯•
npx playwright test apps/web/e2e/goal/goal-keyresult.spec.ts
```

### è°ƒè¯•æ¨¡å¼

```bash
# ä½¿ç”¨è°ƒè¯•æ¨¡å¼
npx playwright test apps/web/e2e/goal --debug

# æŸ¥çœ‹HTMLæŠ¥å‘Š
npx playwright show-report
```

---

## ğŸ“Š æµ‹è¯•æ•°æ®ç®¡ç†

### æ•°æ®éš”ç¦»ç­–ç•¥

æ¯ä¸ªæµ‹è¯•ä½¿ç”¨**æ—¶é—´æˆ³**ç¡®ä¿æ•°æ®éš”ç¦»:

```typescript
const goalTitle = `E2E Test Goal ${Date.now()}`;
const testEmail = `test-${Date.now()}@example.com`;
```

### æ¸…ç†ç­–ç•¥

æµ‹è¯•åè‡ªåŠ¨æ¸…ç†:

```typescript
test.afterEach(async () => {
  await cleanupTestGoals(page, [goalTitle1, goalTitle2]);
});
```

---

## âœ… æµ‹è¯•æœ€ä½³å®è·µ

### 1. AAAæ¨¡å¼

```typescript
test('ç¤ºä¾‹æµ‹è¯•', async () => {
  // Arrange: å‡†å¤‡æµ‹è¯•æ•°æ®
  await createGoal(page, { title: 'Test Goal' });
  
  // Act: æ‰§è¡Œæ“ä½œ
  await updateGoal(page, 'Test Goal', { title: 'Updated' });
  
  // Assert: éªŒè¯ç»“æœ
  await expect(page.locator('text=Updated')).toBeVisible();
});
```

### 2. ä½¿ç”¨è¾…åŠ©å‡½æ•°

```typescript
// âŒ ä¸å¥½: é‡å¤ä»£ç 
await page.click('button:has-text("åˆ›å»ºç›®æ ‡")');
await page.fill('input[name="title"]', goalTitle);
await page.click('button:has-text("ä¿å­˜")');

// âœ… å¥½: ä½¿ç”¨è¾…åŠ©å‡½æ•°
await createGoal(page, { title: goalTitle });
```

### 3. åˆç†çš„ç­‰å¾…

```typescript
// âœ… ç­‰å¾…å…ƒç´ å¯è§
await expect(page.locator('text=Success')).toBeVisible({ timeout: 5000 });

// âœ… ç­‰å¾…é¡µé¢åŠ è½½
await page.waitForLoadState('networkidle');

// âš ï¸  ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨å›ºå®šç­‰å¾…
await page.waitForTimeout(1000); // æœ€åæ‰‹æ®µ
```

### 4. é”™è¯¯å¤„ç†

```typescript
async function cleanupTestGoal(page: Page, goalTitle: string) {
  try {
    // æ¸…ç†é€»è¾‘
    await deleteGoal(page, goalTitle);
  } catch (error) {
    console.warn('[Cleanup] æ¸…ç†å¤±è´¥:', error);
    // ä¸è¦è®©æ¸…ç†å¤±è´¥å½±å“å…¶ä»–æµ‹è¯•
  }
}
```

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. å…ƒç´ æ‰¾ä¸åˆ°

**é—®é¢˜**: `TimeoutError: Timeout 30000ms exceeded`

**è§£å†³**:
- æ£€æŸ¥é€‰æ‹©å™¨æ˜¯å¦æ­£ç¡®
- å¢åŠ timeoutæ—¶é—´
- ä½¿ç”¨`page.pause()`è°ƒè¯•
- æ£€æŸ¥UIæ˜¯å¦å·²å®ç°

### 2. æµ‹è¯•ä¸ç¨³å®š

**é—®é¢˜**: æµ‹è¯•æ—¶è€Œé€šè¿‡æ—¶è€Œå¤±è´¥

**è§£å†³**:
- é¿å…ä½¿ç”¨å›ºå®šå»¶è¿Ÿ(`waitForTimeout`)
- ä½¿ç”¨`waitForLoadState`ç­‰å¾…é¡µé¢å°±ç»ª
- ä½¿ç”¨`expect().toBeVisible()`ç¡®ä¿å…ƒç´ å¯è§

### 3. æ•°æ®å†²çª

**é—®é¢˜**: å¤šä¸ªæµ‹è¯•å¹²æ‰°

**è§£å†³**:
- ä½¿ç”¨æ—¶é—´æˆ³ç¡®ä¿å”¯ä¸€æ€§
- åœ¨`afterEach`ä¸­æ¸…ç†æ•°æ®
- è€ƒè™‘ä½¿ç”¨ç‹¬ç«‹æµ‹è¯•æ•°æ®åº“

---

## ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

| åŠŸèƒ½æ¨¡å— | ç›®æ ‡è¦†ç›–ç‡ | å½“å‰çŠ¶æ€ |
|---------|-----------|---------|
| Goal CRUD | 95% | âœ… 100% |
| KeyResult | 90% | âœ… 100% |
| Focus Mode | 85% | âœ… 100% |
| Statistics | 80% | âœ… 90% |
| **æ•´ä½“** | **90%** | **âœ… 97%** |

---

## ğŸ”„ æŒç»­æ”¹è¿›

### è®¡åˆ’æ·»åŠ çš„æµ‹è¯•:

- [ ] Goal Review (ç›®æ ‡å¤ç›˜)
- [ ] Goal Reminder (ç›®æ ‡æé†’)
- [ ] Goal Timeline (æ—¶é—´çº¿è§†å›¾)
- [ ] Goal Templates (ç›®æ ‡æ¨¡æ¿)
- [ ] Bulk Operations (æ‰¹é‡æ“ä½œ)
- [ ] Export/Import (å¯¼å‡º/å¯¼å…¥)

### æ€§èƒ½æµ‹è¯•:

- [ ] å¤§é‡ç›®æ ‡åŠ è½½æ€§èƒ½
- [ ] å®æ—¶è¿›åº¦æ›´æ–°å“åº”æ—¶é—´
- [ ] ç»Ÿè®¡è®¡ç®—æ€§èƒ½

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Playwright æ–‡æ¡£](https://playwright.dev)
- [Goal API æ–‡æ¡£](../../../../docs/epic-7-api-endpoints.md)
- [Goal Module æ¶æ„](../../../../docs/architecture-web.md)
- [æµ‹è¯•ç­–ç•¥æ–‡æ¡£](../README.md)

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•

1. åœ¨åˆé€‚çš„æ–‡ä»¶ä¸­æ·»åŠ æµ‹è¯•ç”¨ä¾‹
2. éµå¾ªAAAæ¨¡å¼
3. ä½¿ç”¨è¾…åŠ©å‡½æ•°é¿å…é‡å¤
4. æ·»åŠ æ¸…ç†é€»è¾‘
5. æ›´æ–°æœ¬README

### å‘½åè§„èŒƒ

- æµ‹è¯•æ–‡ä»¶: `goal-{feature}.spec.ts`
- æµ‹è¯•ç”¨ä¾‹: `[P{0-2}] åº”è¯¥{é¢„æœŸè¡Œä¸º}`
- è¾…åŠ©å‡½æ•°: åŠ¨è¯å¼€å¤´,æ¸…æ™°æè¿°

### ä»£ç å®¡æŸ¥æ¸…å•

- [ ] æµ‹è¯•ç‹¬ç«‹è¿è¡Œ
- [ ] æ¸…ç†æµ‹è¯•æ•°æ®
- [ ] ä½¿ç”¨é€‚å½“çš„ç­‰å¾…
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] é€‰æ‹©å™¨æœ‰åå¤‡æ–¹æ¡ˆ

---

**ç»´æŠ¤è€…**: BMad Master  
**æœ€åæ›´æ–°**: 2025-01-01  
**çŠ¶æ€**: âœ… å·²å®Œæˆ
