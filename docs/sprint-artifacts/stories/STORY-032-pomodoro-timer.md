# STORY-032: ç•ªèŒ„é’Ÿè®¡æ—¶å™¨

## ğŸ“‹ Story æ¦‚è¿°

**Story ID**: STORY-032  
**Epic**: EPIC-007 (Pomodoro & Focus Mode)  
**ä¼˜å…ˆçº§**: P1 (æ ¸å¿ƒä»·å€¼)  
**é¢„ä¼°å·¥æ—¶**: 2 å¤©  
**çŠ¶æ€**: ğŸ“‹ Ready for Dev  
**å‰ç½®ä¾èµ–**: EPIC-002 âœ… (Desktop Native Features)

---

## ğŸ¯ ç”¨æˆ·æ•…äº‹

**ä½œä¸º** DailyUse æ¡Œé¢ç”¨æˆ·  
**æˆ‘å¸Œæœ›** æœ‰ä¸€ä¸ªç•ªèŒ„é’Ÿè®¡æ—¶å™¨å¸®åŠ©æˆ‘ä¿æŒä¸“æ³¨å·¥ä½œèŠ‚å¥  
**ä»¥ä¾¿äº** ç§‘å­¦ç®¡ç†æˆ‘çš„æ³¨æ„åŠ›ï¼Œæé«˜å·¥ä½œæ•ˆç‡

---

## ğŸ“‹ éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶ - è®¡æ—¶å™¨æ ¸å¿ƒ

- [ ] é»˜è®¤é…ç½®ï¼š25 åˆ†é’Ÿå·¥ä½œ + 5 åˆ†é’ŸçŸ­ä¼‘æ¯ + 15 åˆ†é’Ÿé•¿ä¼‘æ¯
- [ ] 4 ä¸ªç•ªèŒ„åè‡ªåŠ¨è¿›å…¥é•¿ä¼‘æ¯
- [ ] å¼€å§‹/æš‚åœ/é‡ç½®æ§åˆ¶
- [ ] è·³è¿‡å½“å‰é˜¶æ®µï¼ˆå·¥ä½œ/ä¼‘æ¯ï¼‰
- [ ] è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼ˆå¯é…ç½®ï¼‰

### åŠŸèƒ½éªŒæ”¶ - è‡ªå®šä¹‰è®¾ç½®

- [ ] å·¥ä½œæ—¶é•¿å¯é…ç½®ï¼ˆ15-60 åˆ†é’Ÿï¼‰
- [ ] çŸ­ä¼‘æ¯æ—¶é•¿å¯é…ç½®ï¼ˆ3-15 åˆ†é’Ÿï¼‰
- [ ] é•¿ä¼‘æ¯æ—¶é•¿å¯é…ç½®ï¼ˆ10-30 åˆ†é’Ÿï¼‰
- [ ] é•¿ä¼‘æ¯é—´éš”å¯é…ç½®ï¼ˆ2-6 ä¸ªç•ªèŒ„ï¼‰
- [ ] è®¾ç½®å®æ—¶ç”Ÿæ•ˆ

### åŠŸèƒ½éªŒæ”¶ - æ¡Œé¢é›†æˆ

- [ ] ç³»ç»Ÿæ‰˜ç›˜æ˜¾ç¤ºå‰©ä½™æ—¶é—´
- [ ] é˜¶æ®µç»“æŸæ—¶ç³»ç»Ÿé€šçŸ¥
- [ ] é€šçŸ¥å£°éŸ³ï¼ˆå¯å…³é—­ï¼‰
- [ ] å…¨å±€å¿«æ·é”®æ§åˆ¶ï¼ˆå¯é…ç½®ï¼‰

### åŠŸèƒ½éªŒæ”¶ - ä»»åŠ¡å…³è”

- [ ] å¯å…³è”å½“å‰ä¸“æ³¨çš„ä»»åŠ¡
- [ ] ç•ªèŒ„å®Œæˆåè®°å½•åˆ°ä»»åŠ¡
- [ ] æ˜¾ç¤ºä»»åŠ¡ç´¯è®¡ä¸“æ³¨ç•ªèŒ„æ•°
- [ ] æ— ä»»åŠ¡æ—¶ä¹Ÿå¯ç‹¬ç«‹ä½¿ç”¨

### æŠ€æœ¯éªŒæ”¶

- [ ] è®¡æ—¶ç²¾åº¦ Â±1 ç§’
- [ ] æœ€å°åŒ–åç»§ç»­è®¡æ—¶
- [ ] é‡å¯åº”ç”¨æ¢å¤è¿›è¡Œä¸­çš„è®¡æ—¶
- [ ] å†…å­˜å ç”¨å¢åŠ  < 10MB

---

## ğŸ”§ æŠ€æœ¯æ–¹æ¡ˆ

### æ•°æ®æ¨¡å‹

> **æ¶æ„å†³ç­–**: ä¸“æ³¨åŠŸèƒ½ä½œä¸º Goal æ¨¡å—çš„æ‰©å±•ï¼Œè€Œéç‹¬ç«‹æ¨¡å—ã€‚åŸå› ï¼š
> - ä¸“æ³¨æ˜¯ä¸ºäº†å®Œæˆç›®æ ‡/ä»»åŠ¡ï¼Œè‡ªç„¶å±äº Goal é¢†åŸŸ
> - é¿å…æ•°æ®å­¤å²›ï¼Œä¸“æ³¨æ—¶é•¿ç›´æ¥è®¡å…¥ Goal è¿›åº¦
> - å¤ç”¨ Goal çš„ç»Ÿè®¡å’Œè¿½è¸ªåŸºç¡€è®¾æ–½

```typescript
// packages/domain-client/src/goal/entities/
interface PomodoroSession {
  id: string;
  taskId?: string;          // å…³è”çš„ä»»åŠ¡
  type: 'work' | 'shortBreak' | 'longBreak';
  duration: number;         // è®¾å®šæ—¶é•¿ï¼ˆç§’ï¼‰
  startedAt: Date;
  pausedAt?: Date;
  completedAt?: Date;
  status: 'active' | 'paused' | 'completed' | 'cancelled';
}

interface PomodoroSettings {
  workDuration: number;      // é»˜è®¤ 25 åˆ†é’Ÿ
  shortBreakDuration: number; // é»˜è®¤ 5 åˆ†é’Ÿ
  longBreakDuration: number;  // é»˜è®¤ 15 åˆ†é’Ÿ
  longBreakInterval: number;  // é»˜è®¤ 4 ä¸ªç•ªèŒ„
  autoStartBreak: boolean;
  autoStartWork: boolean;
  notificationSound: boolean;
  globalHotkey: string;       // é»˜è®¤ 'Alt+P'
}
```

### æœåŠ¡å±‚

```typescript
// packages/application-client/src/goal/services/PomodoroService.ts
export class PomodoroService {
  // è®¡æ—¶å™¨æ§åˆ¶
  start(taskId?: string): void;
  pause(): void;
  resume(): void;
  reset(): void;
  skip(): void;
  
  // çŠ¶æ€æŸ¥è¯¢
  getCurrentSession(): PomodoroSession | null;
  getRemainingTime(): number;  // ç§’
  getCompletedPomodoros(): number;  // ä»Šæ—¥å®Œæˆæ•°
  
  // è®¾ç½®
  updateSettings(settings: Partial<PomodoroSettings>): void;
  getSettings(): PomodoroSettings;
  
  // äº‹ä»¶
  onTick: (remainingSeconds: number) => void;
  onPhaseComplete: (phase: PomodoroPhase) => void;
  onSessionComplete: (session: PomodoroSession) => void;
}
```

### UI ç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ğŸ… ç•ªèŒ„é’Ÿ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                    â”‚ 24:37 â”‚                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                      â”‚
â”‚                   å·¥ä½œä¸­ ğŸ”´                          â”‚
â”‚                                                      â”‚
â”‚  å½“å‰ä»»åŠ¡: ç¼–å†™ STORY-032 æŠ€æœ¯æ–¹æ¡ˆ                   â”‚
â”‚                                                      â”‚
â”‚     [â–¶ï¸ å¼€å§‹]  [â¸ æš‚åœ]  [â­ è·³è¿‡]  [ğŸ”„ é‡ç½®]       â”‚
â”‚                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä»Šæ—¥: ğŸ…ğŸ…ğŸ…ğŸ… 4 ä¸ªç•ªèŒ„ | 1å°æ—¶40åˆ†é’Ÿ               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [âš™ï¸ è®¾ç½®]                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç³»ç»Ÿæ‰˜ç›˜é›†æˆ

```typescript
// apps/desktop/src/main/tray/PomodoroTray.ts
export class PomodoroTray {
  updateTimer(remainingSeconds: number, phase: PomodoroPhase): void;
  // æ‰˜ç›˜å›¾æ ‡æ˜¾ç¤º: ğŸ… 24:37 æˆ– â˜• 04:12
  
  showNotification(title: string, body: string): void;
  // é˜¶æ®µç»“æŸæ—¶æ˜¾ç¤ºç³»ç»Ÿé€šçŸ¥
}
```

### IPC é€šé“

```typescript
// æ–°å¢ IPC é€šé“
'pomodoro:start'        // å¼€å§‹è®¡æ—¶
'pomodoro:pause'        // æš‚åœ
'pomodoro:resume'       // ç»§ç»­
'pomodoro:skip'         // è·³è¿‡
'pomodoro:reset'        // é‡ç½®
'pomodoro:get-state'    // è·å–å½“å‰çŠ¶æ€
'pomodoro:tick'         // æ¯ç§’å¹¿æ’­ (ä¸»è¿›ç¨‹ â†’ æ¸²æŸ“è¿›ç¨‹)
'pomodoro:phase-change' // é˜¶æ®µå˜åŒ–å¹¿æ’­
```

---

## ğŸ“ æ–‡ä»¶å˜æ›´æ¸…å•

### æ–°å¢æ–‡ä»¶

```
packages/domain-client/src/goal/
  â”œâ”€â”€ entities/PomodoroSession.ts (ä¸“æ³¨ä¼šè¯å®ä½“)
  â”œâ”€â”€ entities/FocusSession.ts (é€šç”¨ä¸“æ³¨ä¼šè¯)
  â”œâ”€â”€ value-objects/PomodoroSettings.ts
  â””â”€â”€ value-objects/FocusStatistics.ts

packages/application-client/src/goal/
  â”œâ”€â”€ services/PomodoroService.ts
  â”œâ”€â”€ services/FocusTrackingService.ts
  â””â”€â”€ utils/PomodoroTimer.ts

apps/desktop/src/main/services/
  â””â”€â”€ PomodoroMainService.ts

apps/desktop/src/main/tray/
  â””â”€â”€ PomodoroTray.ts

apps/desktop/src/renderer/components/pomodoro/
  â”œâ”€â”€ PomodoroTimer.tsx
  â”œâ”€â”€ PomodoroControls.tsx
  â”œâ”€â”€ PomodoroSettings.tsx
  â””â”€â”€ PomodoroStats.tsx

apps/desktop/src/renderer/hooks/
  â””â”€â”€ usePomodoro.ts

apps/desktop/src/preload/channels/
  â””â”€â”€ pomodoroChannels.ts
```

### ä¿®æ”¹æ–‡ä»¶

```
apps/desktop/src/preload/preload.ts
  â””â”€â”€ æ·»åŠ  pomodoro:* é€šé“ç™½åå•

apps/desktop/src/main/main.ts
  â””â”€â”€ åˆå§‹åŒ– PomodoroMainService

apps/desktop/src/renderer/components/Layout.tsx
  â””â”€â”€ åœ¨ä¾§è¾¹æ æ·»åŠ ç•ªèŒ„é’Ÿå…¥å£

packages/domain-client/src/goal/aggregates/Goal.ts
  â””â”€â”€ æ‰©å±•æ–¹æ³•: recordPomodoroSession(), getPomodoroStats(), totalFocusMinutes å­—æ®µ

packages/contracts/src/modules/goal/aggregates/GoalClient.ts
  â””â”€â”€ æ·»åŠ ä¸“æ³¨ç›¸å…³å­—æ®µå’Œæ–¹æ³•ç­¾å
```

---

## ğŸ§ª æµ‹è¯•è¦ç‚¹

### å•å…ƒæµ‹è¯•

- è®¡æ—¶å™¨ç²¾åº¦æµ‹è¯•
- é˜¶æ®µåˆ‡æ¢é€»è¾‘
- è®¾ç½®æŒä¹…åŒ–

### é›†æˆæµ‹è¯•

- ä¸»è¿›ç¨‹ â†” æ¸²æŸ“è¿›ç¨‹åŒæ­¥
- ä»»åŠ¡å…³è”è®¡æ•°
- åº”ç”¨é‡å¯æ¢å¤

### E2E æµ‹è¯•

- å®Œæ•´ç•ªèŒ„å‘¨æœŸ
- è·³è¿‡ä¼‘æ¯ç»§ç»­å·¥ä½œ
- è®¾ç½®ä¿®æ”¹ç”Ÿæ•ˆ

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **è®¡æ—¶å‡†ç¡®æ€§**ï¼šä½¿ç”¨ `setInterval` + æ—¶é—´æˆ³æ ¡å‡†
2. **åå°è¿è¡Œ**ï¼šä¸»è¿›ç¨‹è´Ÿè´£è®¡æ—¶ï¼Œé¿å…æ¸²æŸ“è¿›ç¨‹æœ€å°åŒ–å½±å“
3. **æŒä¹…åŒ–**ï¼šè¿›è¡Œä¸­çš„ç•ªèŒ„ä¿å­˜åˆ° localStorageï¼Œé‡å¯æ¢å¤
4. **æ€§èƒ½**ï¼šæ¯ç§’ tick åªæ›´æ–°å¿…è¦çš„ UI å…ƒç´ 
