# STORY-038: ä¹ æƒ¯æ‰“å¡ä¸Streak

## ğŸ“‹ Story æ¦‚è¿°

**Story ID**: STORY-038  
**Epic**: EPIC-008 (Habit Tracking)  
**ä¼˜å…ˆçº§**: P1 (æ ¸å¿ƒä»·å€¼)  
**é¢„ä¼°å·¥æ—¶**: 2 å¤©  
**çŠ¶æ€**: ğŸ“‹ Ready for Dev  
**å‰ç½®ä¾èµ–**: EPIC-003 âœ… (Goal & Task Management)

---

## ğŸ¯ ç”¨æˆ·æ•…äº‹

**ä½œä¸º** æƒ³è¦å…»æˆè‰¯å¥½ä¹ æƒ¯çš„ DailyUse ç”¨æˆ·  
**æˆ‘å¸Œæœ›** èƒ½å¤Ÿå¿«é€Ÿæ‰“å¡è®°å½•ä¹ æƒ¯å®Œæˆæƒ…å†µï¼Œå¹¶çœ‹åˆ°æˆ‘çš„è¿ç»­æ‰“å¡å¤©æ•°  
**ä»¥ä¾¿äº** æ¿€åŠ±è‡ªå·±åšæŒä¹ æƒ¯ï¼Œäº«å—è¿ç»­æ‰“å¡å¸¦æ¥çš„æˆå°±æ„Ÿ

---

## ğŸ“‹ éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶ - ä¸€é”®æ‰“å¡

- [ ] ä¹ æƒ¯åˆ—è¡¨å¿«é€Ÿæ‰“å¡ï¼ˆç‚¹å‡»å³å®Œæˆï¼‰
- [ ] æ”¯æŒæ’¤é”€ä»Šæ—¥æ‰“å¡ï¼ˆé™å½“æ—¥ï¼‰
- [ ] å·²å®Œæˆä¹ æƒ¯æ˜¾ç¤ºâœ“æ ‡è®°
- [ ] æœªå®Œæˆä¹ æƒ¯æ˜¾ç¤ºç©ºå¿ƒåœ†â—‹
- [ ] æ‰“å¡æ—¶æ˜¾ç¤ºåŠ¨ç”»åé¦ˆ

### åŠŸèƒ½éªŒæ”¶ - Streak è®¡ç®—

- [ ] æ˜¾ç¤ºå½“å‰è¿ç»­æ‰“å¡å¤©æ•°ï¼ˆCurrent Streakï¼‰
- [ ] æ˜¾ç¤ºå†å²æœ€é•¿è¿ç»­å¤©æ•°ï¼ˆLongest Streakï¼‰
- [ ] æ˜¾ç¤ºæ€»æ‰“å¡å¤©æ•°ï¼ˆTotal Daysï¼‰
- [ ] è¿ç»­å¤©æ•°è‡ªåŠ¨è®¡ç®—ï¼Œè·¨å¤©é‡ç½®
- [ ] Streak ä¸­æ–­åä» 0 å¼€å§‹

### åŠŸèƒ½éªŒæ”¶ - è¡¥æ‰“å¡æœºåˆ¶

- [ ] å…è®¸è¡¥æ‰“å¡æ˜¨æ—¥ä¹ æƒ¯ï¼ˆä»…é™1å¤©ï¼‰
- [ ] è¡¥æ‰“å¡éœ€ç”¨æˆ·ç¡®è®¤ï¼ˆé˜²æ­¢è¯¯æ“ä½œï¼‰
- [ ] è¡¥æ‰“å¡æ ‡è®°ä¸º"å·²è¡¥"ï¼Œä¸æ­£å¸¸æ‰“å¡åŒºåˆ†
- [ ] è¡¥æ‰“å¡ä¸å½±å“ Streak è®¡ç®—ï¼ˆå¯é…ç½®ï¼‰
- [ ] æ¯ä¸ªä¹ æƒ¯æœ€å¤šè¡¥æ‰“å¡ 3 æ¬¡/æœˆï¼ˆå¯é…ç½®ï¼‰

### åŠŸèƒ½éªŒæ”¶ - æ‰“å¡åŠ¨ç”»

- [ ] æ‰“å¡æˆåŠŸï¼šâœ“ å¼¹å‡ºåŠ¨ç”» + éŸ³æ•ˆï¼ˆå¯é€‰ï¼‰
- [ ] è¿ç»­æ‰“å¡é‡Œç¨‹ç¢‘ï¼ˆ7å¤©ã€30å¤©ã€100å¤©ï¼‰ç‰¹æ®Šåº†ç¥
- [ ] Streak æ•°å­—è·³åŠ¨åŠ¨ç”»
- [ ] æ’¤é”€æ‰“å¡æ·¡å‡ºåŠ¨ç”»

### åŠŸèƒ½éªŒæ”¶ - æ‰“å¡å†å²

- [ ] æŸ¥çœ‹æŸä¸ªä¹ æƒ¯çš„æ‰“å¡æ—¥å†
- [ ] æ—¥å†æ ‡è®°ï¼šå·²å®Œæˆâœ“ã€å·²è¡¥â—‹ã€æœªå®Œæˆç©º
- [ ] ç‚¹å‡»æ—¥æœŸæŸ¥çœ‹å½“æ—¥å¤‡æ³¨
- [ ] æ”¯æŒæ·»åŠ æ‰“å¡å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰

### æŠ€æœ¯éªŒæ”¶

- [ ] æ‰“å¡å“åº”æ—¶é—´ < 100ms
- [ ] æ”¯æŒç¦»çº¿æ‰“å¡ï¼Œè”ç½‘ååŒæ­¥
- [ ] Streak è®¡ç®—å‡†ç¡®ç‡ 100%
- [ ] è·¨æ—¶åŒºæ­£ç¡®å¤„ç†æ—¥æœŸ

---

## ğŸ”§ æŠ€æœ¯æ–¹æ¡ˆ

### æ•°æ®æ¨¡å‹

```typescript
// packages/domain-client/src/habit/
interface Habit {
  id: string;
  userId: string;
  name: string;
  description?: string;
  icon?: string;                 // emoji æˆ–å›¾æ ‡
  frequency: HabitFrequency;     // daily, weekly, custom
  reminderTime?: string;         // HH:mm
  category?: string;
  isActive: boolean;
  createdAt: Date;
  archivedAt?: Date;
}

interface HabitFrequency {
  type: 'daily' | 'weekly' | 'custom';
  daysOfWeek?: number[];         // 0-6 (å‘¨ä¸€åˆ°å‘¨æ—¥)
  customDays?: Date[];           // è‡ªå®šä¹‰æ—¥æœŸ
}

interface HabitCheckIn {
  id: string;
  habitId: string;
  userId: string;
  date: Date;                    // æ‰“å¡æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
  checkedAt: Date;               // å®é™…æ‰“å¡æ—¶é—´
  isBackfilled: boolean;         // æ˜¯å¦è¡¥æ‰“å¡
  note?: string;                 // æ‰“å¡å¤‡æ³¨
  mood?: 'great' | 'good' | 'ok' | 'bad';  // å¿ƒæƒ…ï¼ˆå¯é€‰ï¼‰
}

interface HabitStreak {
  habitId: string;
  currentStreak: number;         // å½“å‰è¿ç»­å¤©æ•°
  longestStreak: number;         // å†å²æœ€é•¿
  totalDays: number;             // æ€»æ‰“å¡å¤©æ•°
  lastCheckInDate: Date;
  streakStartDate: Date;
  milestones: StreakMilestone[]; // é‡Œç¨‹ç¢‘è®°å½•
}

interface StreakMilestone {
  days: number;                  // 7, 30, 100, etc.
  achievedAt: Date;
  notified: boolean;
}

interface BackfillConfig {
  allowBackfill: boolean;        // æ˜¯å¦å…è®¸è¡¥æ‰“å¡
  backfillDays: number;          // å¯è¡¥æ‰“å¡å¤©æ•°ï¼ˆé»˜è®¤1ï¼‰
  monthlyLimit: number;          // æ¯æœˆè¡¥æ‰“å¡ä¸Šé™ï¼ˆé»˜è®¤3ï¼‰
  affectsStreak: boolean;        // æ˜¯å¦å½±å“Streakï¼ˆé»˜è®¤falseï¼‰
}
```

### æœåŠ¡å±‚

```typescript
// packages/application-client/src/habit/services/HabitCheckInService.ts
export class HabitCheckInService {
  // æ‰“å¡æ“ä½œ
  checkIn(habitId: string, note?: string): Promise<HabitCheckIn>;
  uncheckIn(habitId: string, date: Date): Promise<void>;
  backfillCheckIn(habitId: string, date: Date): Promise<HabitCheckIn>;
  
  // æ‰“å¡æŸ¥è¯¢
  getTodayCheckIns(userId: string): Promise<HabitCheckIn[]>;
  getCheckInHistory(habitId: string, startDate: Date, endDate: Date): Promise<HabitCheckIn[]>;
  isCheckedIn(habitId: string, date: Date): Promise<boolean>;
  
  // è¡¥æ‰“å¡æ£€æŸ¥
  canBackfill(habitId: string, date: Date): Promise<boolean>;
  getRemainingBackfills(habitId: string): Promise<number>;
  
  // äº‹ä»¶
  onCheckIn: (checkIn: HabitCheckIn) => void;
  onUncheckIn: (habitId: string, date: Date) => void;
  onMilestoneAchieved: (milestone: StreakMilestone) => void;
}

// packages/application-client/src/habit/services/HabitStreakService.ts
export class HabitStreakService {
  // Streak è®¡ç®—
  calculateStreak(habitId: string): Promise<HabitStreak>;
  updateStreak(habitId: string, checkIn: HabitCheckIn): Promise<HabitStreak>;
  resetStreak(habitId: string): Promise<void>;
  
  // Streak æŸ¥è¯¢
  getStreak(habitId: string): Promise<HabitStreak>;
  getAllStreaks(userId: string): Promise<HabitStreak[]>;
  getBestStreak(userId: string): Promise<HabitStreak>;
  
  // é‡Œç¨‹ç¢‘
  checkMilestones(streak: HabitStreak): StreakMilestone[];
  notifyMilestone(milestone: StreakMilestone): void;
}
```

### Streak è®¡ç®—ç®—æ³•

```typescript
// è¿ç»­å¤©æ•°è®¡ç®—
class StreakCalculator {
  calculateStreak(checkIns: HabitCheckIn[]): StreakResult {
    // æŒ‰æ—¥æœŸæ’åº
    const sorted = checkIns.sort((a, b) => 
      a.date.getTime() - b.date.getTime()
    );
    
    let currentStreak = 0;
    let longestStreak = 0;
    let tempStreak = 0;
    let lastDate: Date | null = null;
    
    for (const checkIn of sorted) {
      if (!lastDate) {
        tempStreak = 1;
      } else {
        const daysDiff = this.getDaysDiff(lastDate, checkIn.date);
        
        if (daysDiff === 1) {
          // è¿ç»­
          tempStreak++;
        } else {
          // ä¸­æ–­
          longestStreak = Math.max(longestStreak, tempStreak);
          tempStreak = 1;
        }
      }
      
      lastDate = checkIn.date;
    }
    
    // æœ€åä¸€æ®µ
    longestStreak = Math.max(longestStreak, tempStreak);
    
    // æ£€æŸ¥å½“å‰æ˜¯å¦è¿˜åœ¨è¿ç»­
    if (lastDate && this.isToday(lastDate)) {
      currentStreak = tempStreak;
    } else if (lastDate && this.isYesterday(lastDate)) {
      currentStreak = tempStreak; // æ˜¨å¤©æ‰“å¡äº†ï¼Œä»Šå¤©è¿˜æ²¡åˆ°æˆªæ­¢
    } else {
      currentStreak = 0; // Streak å·²ä¸­æ–­
    }
    
    return {
      currentStreak,
      longestStreak,
      totalDays: sorted.length,
    };
  }
  
  private getDaysDiff(date1: Date, date2: Date): number {
    const oneDay = 24 * 60 * 60 * 1000;
    return Math.round((date2.getTime() - date1.getTime()) / oneDay);
  }
  
  private isToday(date: Date): boolean {
    const today = new Date();
    return this.isSameDay(date, today);
  }
  
  private isYesterday(date: Date): boolean {
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    return this.isSameDay(date, yesterday);
  }
  
  private isSameDay(date1: Date, date2: Date): boolean {
    return (
      date1.getFullYear() === date2.getFullYear() &&
      date1.getMonth() === date2.getMonth() &&
      date1.getDate() === date2.getDate()
    );
  }
}
```

### UI ç»„ä»¶

#### ä¹ æƒ¯æ‰“å¡åˆ—è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ“… ä»Šæ—¥ä¹ æƒ¯æ‰“å¡                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  ğŸƒ æ™¨è·‘ 30 åˆ†é’Ÿ              [âœ“] å·²å®Œæˆ             â”‚
â”‚  ğŸ”¥ 7 å¤©è¿ç»­ | æœ€é•¿ 30 å¤©                            â”‚
â”‚                                                      â”‚
â”‚  ğŸ“– é˜…è¯» 30 åˆ†é’Ÿ              [ ] å¾…å®Œæˆ             â”‚
â”‚  ğŸ”¥ 12 å¤©è¿ç»­ | æœ€é•¿ 45 å¤©                           â”‚
â”‚                                                      â”‚
â”‚  ğŸ’§ å– 8 æ¯æ°´                 [âœ“] å·²å®Œæˆ             â”‚
â”‚  ğŸ”¥ 5 å¤©è¿ç»­ | æœ€é•¿ 15 å¤©                            â”‚
â”‚                                                      â”‚
â”‚  ğŸ§˜ å†¥æƒ³ 10 åˆ†é’Ÿ              [ ] å¾…å®Œæˆ             â”‚
â”‚  ğŸ”¥ 3 å¤©è¿ç»­ | æœ€é•¿ 10 å¤©                            â”‚
â”‚                                                      â”‚
â”‚  âš ï¸ æ˜¨æ—¥æœªå®Œæˆï¼šå­¦è‹±è¯­ - [è¡¥æ‰“å¡] æˆ– [è·³è¿‡]          â”‚
â”‚                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä»Šæ—¥è¿›åº¦: 2/4 (50%)                                 â”‚
â”‚  [ + æ·»åŠ ä¹ æƒ¯ ]                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ‰“å¡æˆåŠŸåŠ¨ç”»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚                      âœ“                               â”‚
â”‚                   (æ”¾å¤§åŠ¨ç”»)                         â”‚
â”‚                                                      â”‚
â”‚                  æ‰“å¡æˆåŠŸï¼                          â”‚
â”‚                                                      â”‚
â”‚               ğŸ”¥ è¿ç»­ 8 å¤© ğŸ”¥                        â”‚
â”‚                                                      â”‚
â”‚              ç»§ç»­ä¿æŒï¼ŒåŠ æ²¹ï¼                         â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é‡Œç¨‹ç¢‘åº†ç¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚                  ğŸ‰ æ­å–œä½ ï¼ğŸ‰                       â”‚
â”‚                                                      â”‚
â”‚                      ğŸ†                              â”‚
â”‚                                                      â”‚
â”‚            "æ™¨è·‘ 30 åˆ†é’Ÿ" è¿ç»­ 30 å¤©ï¼               â”‚
â”‚                                                      â”‚
â”‚          ä½ å·²ç»å½¢æˆäº†ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼                    â”‚
â”‚                                                      â”‚
â”‚              [ åˆ†äº«æˆå°± ]  [ ç»§ç»­ ]                  â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¡¥æ‰“å¡ç¡®è®¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ“ è¡¥æ‰“å¡ç¡®è®¤                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  ä¹ æƒ¯: é˜…è¯» 30 åˆ†é’Ÿ                                  â”‚
â”‚  æ—¥æœŸ: 2025-12-07 (æ˜¨å¤©)                             â”‚
â”‚                                                      â”‚
â”‚  âš ï¸ æ³¨æ„ï¼š                                           â”‚
â”‚  â€¢ æœ¬æœˆå‰©ä½™è¡¥æ‰“å¡æ¬¡æ•°ï¼š2 æ¬¡                          â”‚
â”‚  â€¢ è¡¥æ‰“å¡ä¸ä¼šå½±å“è¿ç»­å¤©æ•°è®¡ç®—                        â”‚
â”‚  â€¢ ä»…é™è¡¥æ‰“å¡æ˜¨å¤©çš„ä¹ æƒ¯                              â”‚
â”‚                                                      â”‚
â”‚  å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ æ˜¨æ™šä¸´æ—¶åŠ ç­ï¼Œå¿˜è®°æ‰“å¡äº†                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                      â”‚
â”‚             [ ç¡®è®¤è¡¥æ‰“å¡ ]  [ å–æ¶ˆ ]                 â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä¹ æƒ¯è¯¦æƒ… - æ‰“å¡æ—¥å†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸƒ æ™¨è·‘ 30 åˆ†é’Ÿ - æ‰“å¡å†å²              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  ğŸ“Š ç»Ÿè®¡                                             â”‚
â”‚  ğŸ”¥ å½“å‰è¿ç»­: 7 å¤©                                   â”‚
â”‚  ğŸ† æœ€é•¿è¿ç»­: 30 å¤©                                  â”‚
â”‚  âœ“ æ€»æ‰“å¡: 87 å¤©                                     â”‚
â”‚                                                      â”‚
â”‚  ğŸ“… 2025 å¹´ 12 æœˆ                        < >         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ä¸€  äºŒ  ä¸‰  å››  äº”  å…­  æ—¥           â”‚           â”‚
â”‚  â”‚                      1âœ“  2âœ“  3âœ“     â”‚           â”‚
â”‚  â”‚ 4âœ“  5âœ“  6âœ“  7âœ“  8âœ“  9â—‹  10         â”‚           â”‚
â”‚  â”‚ 11âœ“ 12âœ“ 13âœ“ 14âœ“ 15âœ“ 16âœ“ 17âœ“       â”‚           â”‚
â”‚  â”‚ 18âœ“ 19âœ“ 20âœ“ 21âœ“ 22âœ“ 23âœ“ 24âœ“       â”‚           â”‚
â”‚  â”‚ 25âœ“ 26âœ“ 27âœ“ 28âœ“ 29âœ“ 30âœ“ 31        â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                      â”‚
â”‚  å›¾ä¾‹: âœ“ å·²æ‰“å¡  â—‹ è¡¥æ‰“å¡  ç©º æœªå®Œæˆ                â”‚
â”‚                                                      â”‚
â”‚  ğŸ’¡ 12æœˆ9æ—¥ - è¡¥æ‰“å¡                                 â”‚
â”‚  å¤‡æ³¨: é‚£å¤©å»çˆ¬å±±äº†ï¼Œç®—æ˜¯æ›´é«˜å¼ºåº¦çš„è¿åŠ¨              â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ‰“å¡åŠ¨ç”»å®ç°

```typescript
// ä½¿ç”¨ Framer Motion æˆ– CSS animations
import { motion } from 'framer-motion';

const CheckInAnimation = () => (
  <motion.div
    initial={{ scale: 0, opacity: 0 }}
    animate={{ scale: 1, opacity: 1 }}
    exit={{ scale: 0, opacity: 0 }}
    transition={{ type: 'spring', stiffness: 300, damping: 20 }}
  >
    <CheckIcon />
  </motion.div>
);

const StreakCounter = ({ value }: { value: number }) => (
  <motion.span
    key={value}
    initial={{ y: -20, opacity: 0 }}
    animate={{ y: 0, opacity: 1 }}
    transition={{ type: 'spring' }}
  >
    {value}
  </motion.span>
);

const MilestoneModal = () => (
  <motion.div
    initial={{ scale: 0, rotate: -180 }}
    animate={{ scale: 1, rotate: 0 }}
    transition={{ type: 'spring', duration: 0.8 }}
  >
    ğŸ†
  </motion.div>
);
```

---

## ğŸ“ æ–‡ä»¶å˜æ›´æ¸…å•

### æ–°å¢æ–‡ä»¶

```
packages/domain-client/src/habit/
  â”œâ”€â”€ aggregates/Habit.ts
  â”œâ”€â”€ aggregates/HabitCheckIn.ts
  â”œâ”€â”€ aggregates/HabitStreak.ts
  â”œâ”€â”€ value-objects/HabitFrequency.ts
  â”œâ”€â”€ value-objects/BackfillConfig.ts
  â””â”€â”€ index.ts

packages/application-client/src/habit/
  â”œâ”€â”€ services/HabitService.ts
  â”œâ”€â”€ services/HabitCheckInService.ts
  â”œâ”€â”€ services/HabitStreakService.ts
  â””â”€â”€ utils/StreakCalculator.ts

packages/infrastructure-client/src/repositories/
  â”œâ”€â”€ HabitRepository.ts
  â”œâ”€â”€ HabitCheckInRepository.ts
  â””â”€â”€ HabitStreakRepository.ts

apps/desktop/src/renderer/components/habit/
  â”œâ”€â”€ HabitListPage.tsx
  â”œâ”€â”€ HabitCard.tsx
  â”œâ”€â”€ CheckInButton.tsx
  â”œâ”€â”€ CheckInAnimation.tsx
  â”œâ”€â”€ StreakBadge.tsx
  â”œâ”€â”€ MilestoneModal.tsx
  â”œâ”€â”€ BackfillConfirmModal.tsx
  â”œâ”€â”€ HabitCalendar.tsx
  â””â”€â”€ HabitDetailPage.tsx

apps/desktop/src/renderer/hooks/
  â”œâ”€â”€ useHabits.ts
  â”œâ”€â”€ useCheckIn.ts
  â””â”€â”€ useStreak.ts

apps/desktop/src/renderer/animations/
  â””â”€â”€ checkInAnimations.ts
```

### ä¿®æ”¹æ–‡ä»¶

```
apps/desktop/src/renderer/routes.tsx
  â””â”€â”€ æ·»åŠ ä¹ æƒ¯é¡µé¢è·¯ç”±

apps/desktop/src/renderer/components/Layout.tsx
  â””â”€â”€ æ·»åŠ ä¹ æƒ¯æ¨¡å—å¯¼èˆª

package.json
  â””â”€â”€ æ·»åŠ åŠ¨ç”»åº“ä¾èµ– (framer-motion)
```

---

## ğŸ§ª æµ‹è¯•è¦ç‚¹

### å•å…ƒæµ‹è¯•

- Streak è®¡ç®—ç®—æ³•å‡†ç¡®æ€§
- è·¨å¤©è¾¹ç•Œæ¡ä»¶å¤„ç†
- è¡¥æ‰“å¡æ¬¡æ•°é™åˆ¶
- é‡Œç¨‹ç¢‘è§¦å‘æ¡ä»¶

### é›†æˆæµ‹è¯•

- æ‰“å¡å Streak è‡ªåŠ¨æ›´æ–°
- æ’¤é”€æ‰“å¡å›æ»šçŠ¶æ€
- è¡¥æ‰“å¡å½±å“ Streak è®¡ç®—
- è·¨æ—¶åŒºæ—¥æœŸå¤„ç†

### E2E æµ‹è¯•

- å®Œæ•´æ‰“å¡æµç¨‹
- è¿ç»­å¤šæ—¥æ‰“å¡
- è¡¥æ‰“å¡å®Œæ•´æµç¨‹
- é‡Œç¨‹ç¢‘å¼¹çª—æ˜¾ç¤º

### æ€§èƒ½æµ‹è¯•

- æ‰“å¡å“åº”æ—¶é—´
- å¤§é‡å†å²æ•°æ®æŸ¥è¯¢
- åŠ¨ç”»æµç•…åº¦

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ—¥æœŸå¤„ç†**ï¼šç»Ÿä¸€ä½¿ç”¨æœ¬åœ°æ—¶åŒºçš„æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ï¼Œé¿å…è·¨æ—¶åŒºé—®é¢˜
2. **Streak å‡†ç¡®æ€§**ï¼šç®—æ³•å¿…é¡» 100% å‡†ç¡®ï¼Œè¿™ç›´æ¥å½±å“ç”¨æˆ·ä¿¡ä»»
3. **è¡¥æ‰“å¡é™åˆ¶**ï¼šè¦åˆç†é™åˆ¶è¡¥æ‰“å¡æ¬¡æ•°ï¼Œé¿å…æ»¥ç”¨
4. **åŠ¨ç”»æ€§èƒ½**ï¼šæ‰“å¡åŠ¨ç”»è¦æµç•…ï¼Œä½†ä¸èƒ½é˜»å¡ UI
5. **ç¦»çº¿æ”¯æŒ**ï¼šæ‰“å¡æ“ä½œè¦æ”¯æŒç¦»çº¿ï¼Œè”ç½‘ååŒæ­¥
6. **æ•°æ®æŒä¹…åŒ–**ï¼šæ‰“å¡æ•°æ®è¦å¯é æŒä¹…åŒ–ï¼Œä¸èƒ½ä¸¢å¤±
7. **ç”¨æˆ·æ¿€åŠ±**ï¼šé‡Œç¨‹ç¢‘è¦æœ‰ä»ªå¼æ„Ÿï¼Œå¢å¼ºæˆå°±æ„Ÿ
8. **è¯¯æ“ä½œä¿æŠ¤**ï¼šæ’¤é”€æ‰“å¡ä»…é™å½“æ—¥ï¼Œé˜²æ­¢æ¶æ„ä¿®æ”¹å†å²

---

## ğŸš€ æœªæ¥æ‰©å±•

1. **ç¤¾äº¤åŠŸèƒ½**ï¼šå¥½å‹é—´å¯è§å½¼æ­¤çš„ Streakï¼Œäº’ç›¸æ¿€åŠ±
2. **æ™ºèƒ½æé†’**ï¼šæ ¹æ®å†å²ä¹ æƒ¯æ™ºèƒ½æ¨èæœ€ä½³æ‰“å¡æ—¶é—´
3. **AI åˆ†æ**ï¼šåˆ†ææ‰“å¡æ¨¡å¼ï¼Œè¯†åˆ«å®¹æ˜“ä¸­æ–­çš„ä¹ æƒ¯
4. **æŒ‘æˆ˜æ¨¡å¼**ï¼š30å¤©æŒ‘æˆ˜ã€90å¤©æŒ‘æˆ˜ç­‰
5. **å¥–åŠ±ç³»ç»Ÿ**ï¼šè¿ç»­æ‰“å¡è·å¾—è™šæ‹Ÿå¥–åŠ±
6. **æ•°æ®å¯è§†åŒ–**ï¼šæ›´ä¸°å¯Œçš„ç»Ÿè®¡å›¾è¡¨
7. **ä¹ æƒ¯åˆ†ç»„**ï¼šæ™¨é—´ä¹ æƒ¯ã€æ™šé—´ä¹ æƒ¯ç­‰åˆ†ç»„ç®¡ç†
8. **è¯­éŸ³æ‰“å¡**ï¼šé€šè¿‡è¯­éŸ³å¿«é€Ÿå®Œæˆæ‰“å¡
