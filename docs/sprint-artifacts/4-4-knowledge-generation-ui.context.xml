<story-context id="story-4-4-knowledge-generation-ui" v="1.0">
  <metadata>
    <epicId>4</epicId>
    <storyId>4-4</storyId>
    <title>Knowledge Generation UI</title>
    <status>drafted</status>
    <generatedAt>2025-11-21</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/4-4-knowledge-generation-ui.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>As a User</asA>
    <iWant>I want to easily create a knowledge library</iWant>
    <soThat>So that I can support my goals.</soThat>
    <tasks><![CDATA[
Task 1: Type definitions (KnowledgeGenerationTask, GeneratedDocumentPreview, enums)
Task 2: useKnowledgeGeneration composable (state, polling, actions)
Task 3: Polling logic (start, interval, stop, completion fetch)
Task 4: Wizard Step 1 (input form validation & startGeneration)
Task 5: Wizard Step 2 (progress, status list, auto advance)
Task 6: Wizard Step 3 (review cards + discard)
Task 7: Wizard Step 4 (confirmation & navigation link)
Task 8: Cancel workflow (confirmation dialog + cleanup)
Task 9: Error handling (mapping, retry options)
Task 10: Knowledge Base integration link
Task 11: Composable unit tests (polling lifecycle, discard, cancel)
Task 12: Wizard component tests (step transitions, error states)
Task 13: Accessibility & UX polish (ARIA, focus, progress announcements)
Task 14: Responsive layout for breakpoints
    ]]></tasks>
  </story>

  <acceptanceCriteria><![CDATA[
AC-1: 4-step wizard (Input, Generation, Review, Confirmation)
AC-2: Step 1 input fields (topic 1-100 chars, count 3-7, audience)
AC-3: Step 2 progress bar reflects 0-100%
AC-4: Step 2 estimated time remaining displayed
AC-5: Step 2 document status list (Generating/Completed/Failed)
AC-6: Step 3 preview cards (title, excerpt, word count)
AC-7: Step 3 discard action removes card locally
AC-8: Step 4 confirmation message + folder link
AC-9: Cancel button available at all steps
AC-10: Error handling for API failures (mapped messages)
AC-11: Uses useKnowledgeGeneration composable
AC-12: Calls backend knowledge-series endpoints
AC-13: Polling interval 2 seconds
AC-14: Uses Vuetify stepper component
AC-15: Responsive design working mobile & desktop
AC-16: Component tests for wizard
AC-17: Unit tests for composable
AC-18: Zero TypeScript errors
AC-19: Accessibility (keyboard, ARIA, progress live region)
  ]]></acceptanceCriteria>

  <artifacts>
    <docs><![CDATA[
{ "items": [
  {"path": "docs/sprint-artifacts/tech-spec-epic-4.md", "title": "Epic 4 Tech Spec", "section": "Frontend Architecture", "snippet": "Wizard UI for async knowledge generation with polling."},
  {"path": "docs/epics.md", "title": "Epics File", "section": "Story 4.4 Definition", "snippet": "Defines 4-step wizard and discard capability."},
  {"path": "docs/architecture-web.md", "title": "Web Architecture", "section": "Stepper Patterns", "snippet": "Reusable step orchestration & composable state management."},
  {"path": "docs/sprint-artifacts/4-3-knowledge-generation-backend.md", "title": "Story 4.3 Backend", "section": "API Contract", "snippet": "Endpoints used for polling and document fetch."}
]}
    ]]></docs>
    <code><![CDATA[
{ "items": [
  {"path": "apps/web/src/modules/ai-tools/composables/useKnowledgeGeneration.ts", "kind": "composable", "symbol": "useKnowledgeGeneration", "reason": "Central state & polling (AC-11,12,13)."},
  {"path": "apps/web/src/modules/ai-tools/components/KnowledgeGenerationWizard.vue", "kind": "component", "symbol": "KnowledgeGenerationWizard", "reason": "Wizard steps (AC-1..9,14,15)."},
  {"path": "apps/web/src/modules/ai-tools/components/KnowledgeDocumentCard.vue", "kind": "component", "symbol": "KnowledgeDocumentCard", "reason": "Preview & discard (AC-6,7)."},
  {"path": "apps/web/src/modules/ai-tools/types/knowledgeGeneration.ts", "kind": "types", "symbol": "KnowledgeGenerationTask", "reason": "Type contracts (Task 1)."},
  {"path": "vitest.config.ts", "kind": "config", "symbol": "vitest config", "reason": "Testing (AC-16,17)."}
]}
    ]]></code>
    <dependencies><![CDATA[
{ "runtime": [
  {"name": "vue", "version": "^3.x", "reason": "Framework."},
  {"name": "vuetify", "version": "^3.x", "reason": "Stepper & UI components."},
  {"name": "@dailyuse/contracts", "version": "workspace:*", "reason": "Align with backend DTO fields."}
], "dev": [
  {"name": "vitest", "version": "^3.x", "reason": "Unit & component tests."},
  {"name": "@testing-library/vue", "version": "^8.x", "reason": "Wizard interaction tests."}
]}
    ]]></dependencies>
  </artifacts>

  <constraints><![CDATA[
Wizard must not perform direct polling logic inside components—delegate to composable. Discard is client-side only (no backend delete). Polling interval fixed at 2000ms; do not implement exponential backoff (out of scope). Cancel stops polling immediately and clears interval to avoid leaks. Focus management after step changes required for accessibility. Avoid adding new global state library (Pinia) per epic constraints. Estimated time may be heuristic—must not block progression.
  ]]></constraints>

  <interfaces><![CDATA[
{ "ui": [
  {"name": "Start Generation", "kind": "method", "signature": "useKnowledgeGeneration.startGeneration(request): Promise<void>"},
  {"name": "Cancel Task", "kind": "method", "signature": "useKnowledgeGeneration.cancelTask(): void"},
  {"name": "Discard Document", "kind": "method", "signature": "useKnowledgeGeneration.discardDocument(uuid: string): void"},
  {"name": "Backend Create Task", "kind": "POST", "signature": "POST /api/ai/generate/knowledge-series → 202 { taskUuid }"},
  {"name": "Backend Task Status", "kind": "GET", "signature": "GET /api/ai/generate/knowledge-series/:taskId → KnowledgeGenerationTaskDTO"},
  {"name": "Backend Documents", "kind": "GET", "signature": "GET /api/ai/generate/knowledge-series/:taskId/documents → GeneratedDocument[]"}
]}
    ]]></interfaces>

  <tests>
    <standards><![CDATA[
Composable tests mock api client & timers (use fake timers for interval). Component tests mount wizard and simulate step transitions. Accessibility checks verify ARIA on stepper and live region updates for progress. All functional ACs mapped to test cases.
    ]]></standards>
    <locations><![CDATA[
apps/web/src/modules/ai-tools/composables/__tests__
apps/web/src/modules/ai-tools/components/__tests__
    ]]></locations>
    <ideas><![CDATA[
TC-AC-2: Invalid topic length disables Next.
TC-AC-3: Progress bar shows determinate value after first poll update.
TC-AC-5: Status chip color changes on completion/failed.
TC-AC-7: Discard removes card; underlying array length decrements.
TC-AC-9: Cancel resets state & stops polling (interval cleared).
TC-AC-10: Simulate 429 error → mapped quota exceeded message.
TC-AC-13: Polling occurs every ~2000ms (fake timer assertions).
TC-AC-14: Stepper renders 4 steps with correct labels.
TC-AC-18: TypeScript build passes (no errors).
TC-AC-19: Focus first input on entering Step 1; live region announces progress increments.
    ]]></ideas>
  </tests>
</story-context>
