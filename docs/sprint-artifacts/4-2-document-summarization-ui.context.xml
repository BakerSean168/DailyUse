<story-context id="story-4-2-document-summarization-ui" v="1.0">
  <metadata>
    <epicId>4</epicId>
    <storyId>4-2</storyId>
    <title>Document Summarization UI</title>
    <status>drafted</status>
    <generatedAt>2025-11-21</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/4-2-document-summarization-ui.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>As a User</asA>
    <iWant>I want to use the summarization tool</iWant>
    <soThat>So that I can process information faster.</soThat>
    <tasks><![CDATA[
Task 1: Create Type Definitions (SummaryResult, SummarizationRequest)
Task 2: Build useDocumentSummarizer composable (state, API integration, clipboard)
Task 3: Implement SummaryDisplay.vue (structured sections + metadata)
Task 4: Implement DocumentSummarizer.vue container (input, actions, output, responsive)
Task 5: Module structure & router/nav integration (/ai-tools/summarizer)
Task 6: Copy to clipboard formatting & feedback (snackbar)
Task 7: Error handling & loading UX (spinner, alerts, disable states)
Task 8: Unit tests for composable (state, methods, edge cases)
Task 9: Component tests for DocumentSummarizer.vue (interaction, rendering)
Task 10: Accessibility & UX polish (ARIA, focus, keyboard navigation)
    ]]></tasks>
  </story>

  <acceptanceCriteria><![CDATA[
AC-1: Text input accepts paste up to 50,000 chars
AC-2: Character count indicator shows current/max
AC-3: Summarize button disabled when invalid (empty/too long)
AC-4: Loading spinner during API call
AC-5: Structured summary sections rendered (Core, Key Points, Action Items)
AC-6: Copy to Clipboard button copies formatted text
AC-7: User-friendly error messages for failures
AC-8: Clear button resets input/output state
AC-9: Toggle include action items (default true)
AC-10: Uses useDocumentSummarizer composable
AC-11: Calls POST /api/ai/summarize via unified client
AC-12: Displays compression ratio metadata
AC-13: Responsive (mobile/desktop)
AC-14: Uses Vuetify components only (no custom raw HTML layouts)
AC-15: Component tests for DocumentSummarizer.vue
AC-16: Unit tests for useDocumentSummarizer
AC-17: Zero TypeScript errors
AC-18: Accessibility (keyboard, ARIA, focus management)
  ]]></acceptanceCriteria>

  <artifacts>
    <docs><![CDATA[
{ "items": [
  {"path": "docs/sprint-artifacts/tech-spec-epic-4.md", "title": "Epic 4 Tech Spec", "section": "Frontend Architecture", "snippet": "Summarization UI uses composable pattern, structured summary rendering."},
  {"path": "docs/epics.md", "title": "Epics File", "section": "Story 4.2 Definition", "snippet": "UI invokes POST /api/ai/summarize and renders structured output."},
  {"path": "docs/architecture-web.md", "title": "Web Architecture", "section": "Component + Composable Pattern", "snippet": "Container component delegates logic to composable; presentation components stateless."},
  {"path": "docs/sprint-artifacts/4-1-document-summarization-backend.md", "title": "Story 4.1 Backend", "section": "API Contract", "snippet": "Defines response schema consumed by UI (summary + metadata)."}
]}
    ]]></docs>
    <code><![CDATA[
{ "items": [
  {"path": "apps/web/src/modules/ai-tools/composables/useDocumentSummarizer.ts", "kind": "composable", "symbol": "useDocumentSummarizer", "reason": "State & API orchestration (AC-10,11)."},
  {"path": "apps/web/src/modules/ai-tools/components/DocumentSummarizer.vue", "kind": "component", "symbol": "DocumentSummarizer", "reason": "Container component (AC-1..4,7..9,13,14)."},
  {"path": "apps/web/src/modules/ai-tools/components/SummaryDisplay.vue", "kind": "component", "symbol": "SummaryDisplay", "reason": "Structured summary presentation (AC-5,6,12)."},
  {"path": "apps/web/src/modules/ai-tools/types/summarization.ts", "kind": "types", "symbol": "SummaryResult", "reason": "Shared type contracts (Task 1)."},
  {"path": "vitest.config.ts", "kind": "config", "symbol": "vitest config", "reason": "Testing setup (AC-15,16)."}
]}
    ]]></code>
    <dependencies><![CDATA[
{ "runtime": [
  {"name": "vue", "version": "^3.x", "reason": "UI framework."},
  {"name": "vuetify", "version": "^3.x", "reason": "Material components (AC-14)."},
  {"name": "@dailyuse/contracts", "version": "workspace:*", "reason": "DTO/type alignment with backend."}
], "dev": [
  {"name": "vitest", "version": "^3.x", "reason": "Unit/component tests."},
  {"name": "@testing-library/vue", "version": "^8.x", "reason": "Component interaction tests."}
]}
    ]]></dependencies>
  </artifacts>

  <constraints><![CDATA[
Composable must encapsulate API logic (no direct fetch calls in components). Presentation component (SummaryDisplay) must remain stateless and receive fully validated data. Character limit enforcement prior to API call prevents unnecessary requests. Error mapping standardized (status code → message). Clipboard use must handle permission errors gracefully. Maintain accessibility (focus management after summarize, ARIA labels on interactive controls). Avoid Pinia introduction (scope limited per tech spec). No inline style blocks that violate existing styling conventions.
  ]]></constraints>

  <interfaces><![CDATA[
{ "ui": [
  {"name": "Summarize Action", "kind": "method", "signature": "useDocumentSummarizer.summarize(): Promise<void>", "path": "apps/web/src/modules/ai-tools/composables/useDocumentSummarizer.ts"},
  {"name": "Clipboard", "kind": "method", "signature": "useDocumentSummarizer.copyToClipboard(): void", "path": "apps/web/src/modules/ai-tools/composables/useDocumentSummarizer.ts"},
  {"name": "Backend Endpoint", "kind": "POST", "signature": "POST /api/ai/summarize → SummarizationResultDTO", "path": "apps/api/src/modules/ai/interface/http/AIConversationController.ts"}
]}
    ]]></interfaces>

  <tests>
    <standards><![CDATA[
Use Vitest + Testing Library. Composable unit tests mock unified api client. Component tests mount with Vuetify plugin. 100% AC coverage required for functional & technical criteria. Accessibility checks include keyboard navigation and ARIA attributes presence.
    ]]></standards>
    <locations><![CDATA[
apps/web/src/modules/ai-tools/composables/__tests__
apps/web/src/modules/ai-tools/components/__tests__
    ]]></locations>
    <ideas><![CDATA[
TC-AC-1: Paste 49,999 chars accepted; 50,001 rejected (button disabled).
TC-AC-3: Empty input disables Summarize button.
TC-AC-4: isLoading true shows spinner overlay.
TC-AC-5: SummaryDisplay renders 3 sections; actionItems hidden when absent.
TC-AC-6: Clipboard copies formatted text; verify content lines count.
TC-AC-7: 429 maps to quota exceeded message.
TC-AC-12: Compression ratio chip shows numeric value < 1.
TC-AC-13: Snapshot/layout shift between mobile/desktop breakpoints.
TC-AC-16: Composable summarize() sets summary then clears error.
TC-AC-18: Tab order flows textarea → toggle → buttons; all controls focusable.
    ]]></ideas>
  </tests>
</story-context>
