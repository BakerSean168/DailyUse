# Feature Spec: 任务标签系统

> **功能编号**: TASK-007  
> **RICE 评分**: 133 (Reach: 7, Impact: 5, Confidence: 7.6, Effort: 2)  
> **优先级**: P2  
> **预估时间**: 1-1.5 周  
> **状态**: Draft  
> **负责人**: TBD  
> **最后更新**: 2025-10-21

---

## 1. 概述与目标

### 背景与痛点

任务管理中，用户需要多维度组织和查找任务：
- ❌ 仅靠项目分类不够灵活
- ❌ 无法快速筛选特定类型任务（紧急、重要、等待反馈）
- ❌ 缺少跨项目的主题视图（如所有"需要评审"的任务）
- ❌ 标签管理混乱，命名不统一

### 目标用户

- **主要用户**: 管理大量任务的高级用户
- **次要用户**: 需要多维度筛选的团队
- **典型画像**: "我想看所有标记为'等待反馈'的任务，不论它属于哪个项目"

### 价值主张

**一句话价值**: 通过标签系统实现任务的多维度分类和快速筛选

**核心收益**:
- ✅ 为任务添加多个标签
- ✅ 标签自动补全和建议
- ✅ 按标签快速筛选
- ✅ 标签统计和可视化
- ✅ 团队标签规范化

---

## 2. 用户价值与场景

### 核心场景 1: 为任务添加标签

**场景描述**:  
用户为任务添加一个或多个标签。

**用户故事**:
```gherkin
As a 用户
I want 为任务添加标签
So that 按不同维度分类任务
```

**操作流程**:
1. 用户打开任务详情页
2. 点击"添加标签"输入框：
   ```
   任务详情: API 性能优化
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🏷️ 标签
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [+ 添加标签...]
   
   (暂无标签)
   ```

3. 输入"紧"，触发自动补全：
   ```
   [+ 添加标签... 紧█]
   
   建议标签：
   🔴 紧急 (52 个任务使用)
   🟡 紧要 (12 个任务使用)
   
   或按 Enter 创建新标签 "紧"
   ```

4. 用户选择"紧急"
5. 继续输入"后端"，创建新标签
6. 标签显示更新：
   ```
   🏷️ 标签
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🔴 紧急  ⚙️ 后端  [+ 添加...]
   ```

**预期结果**:
- 支持多标签
- 智能补全
- 快速创建

---

### 核心场景 2: 按标签筛选任务

**场景描述**:  
用户通过标签快速筛选任务。

**用户故事**:
```gherkin
As a 用户
I want 按标签筛选任务
So that 快速找到特定类型的任务
```

**操作流程**:
1. 用户在任务列表点击"筛选"
2. 展开标签筛选器：
   ```
   🔍 筛选任务
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   状态: [全部 ▼]
   优先级: [全部 ▼]
   
   🏷️ 标签:
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   常用标签：
   ☐ 🔴 紧急 (15)
   ☐ ⚙️ 后端 (23)
   ☐ 🎨 前端 (18)
   ☐ 🐛 Bug (12)
   ☐ ✨ 新功能 (27)
   
   [更多标签...]
   
   搜索标签: [输入...]
   ```

3. 用户勾选"紧急"和"后端"
4. 任务列表实时更新：
   ```
   任务列表 - 筛选结果 (5 个任务)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   当前筛选: 🔴 紧急 AND ⚙️ 后端  [清除]
   
   ☐ API 性能优化
      🔴 紧急  ⚙️ 后端  截止: 今天
      
   ☐ 数据库连接池问题
      🔴 紧急  ⚙️ 后端  🐛 Bug
      
   ☐ 缓存策略调整
      🔴 紧急  ⚙️ 后端
   ```

**预期结果**:
- 多标签组合筛选（AND/OR）
- 实时更新
- 显示匹配数量

---

### 核心场景 3: 标签统计和管理

**场景描述**:  
用户查看标签使用统计，管理标签。

**用户故事**:
```gherkin
As a 用户
I want 查看标签统计
So that 了解任务分布
```

**操作流程**:
1. 用户打开"标签管理"页面
2. 显示标签统计：
   ```
   🏷️ 标签管理
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 标签统计
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   总标签数: 28 个
   本月新增: 5 个
   活跃标签: 18 个（有任务关联）
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   📈 使用最多的标签
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ⚙️ 后端           ████████████████░░░░  23 个任务
   ✨ 新功能         ████████████░░░░░░░░  27 个任务
   🎨 前端           ██████████░░░░░░░░░░  18 个任务
   🔴 紧急           ████████░░░░░░░░░░░░  15 个任务
   🐛 Bug            ██████░░░░░░░░░░░░░░  12 个任务
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   🗂️ 所有标签
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   按: [使用次数 ▼] [名称 ▼] [创建时间 ▼]
   
   🔴 紧急 (15)           [重命名] [合并] [删除]
   ⚙️ 后端 (23)           [重命名] [合并] [删除]
   🎨 前端 (18)           [重命名] [合并] [删除]
   📝 待评审 (0)          [删除]  ← 未使用
   
   [创建新标签]
   ```

3. 用户发现"待评审"未使用，点击"删除"
4. 用户发现"紧急"和"urgent"重复，点击"合并"

**预期结果**:
- 清晰的统计视图
- 标签管理功能
- 识别未使用标签

---

### 核心场景 4: 智能标签建议

**场景描述**:  
系统根据任务内容自动建议标签。

**用户故事**:
```gherkin
As a 用户
I want 获得标签建议
So that 减少手动输入
```

**操作流程**:
1. 用户创建任务："修复登录页面样式问题"
2. 系统分析关键词：
   ```typescript
   function suggestTags(taskTitle: string): string[] {
     const suggestions: string[] = [];
     
     // 关键词匹配
     if (/修复|bug|问题/i.test(taskTitle)) {
       suggestions.push('Bug');
     }
     if (/登录|注册|用户/i.test(taskTitle)) {
       suggestions.push('用户模块');
     }
     if (/样式|页面|UI|前端/i.test(taskTitle)) {
       suggestions.push('前端');
     }
     
     return suggestions;
   }
   ```

3. 显示建议：
   ```
   💡 建议标签
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   基于任务标题，建议添加：
   
   🐛 Bug  [添加]
   🎨 前端  [添加]
   👤 用户模块  [添加]
   
   [全部添加] [忽略]
   ```

4. 用户点击"全部添加"
5. 标签自动添加到任务

**预期结果**:
- 智能识别
- 提高效率
- 学习用户习惯

---

## 3. 设计要点

### 涉及字段（Contracts）

#### 新增实体：TaskTag

```typescript
export interface TaskTagServerDTO {
  readonly uuid: string;
  readonly name: string;
  readonly color?: string;
  readonly icon?: string;
  readonly userId: string;
  readonly usageCount: number;
  readonly createdAt: number;
  readonly updatedAt: number;
}
```

#### 更新 Task 实体

```typescript
export interface TaskServerDTO {
  // ...existing fields...
  readonly tags: string[];  // Tag UUID 数组
}
```

---

## 4. MVP 范围

### MVP（1 周）

- ✅ 添加/删除标签
- ✅ 标签自动补全
- ✅ 按标签筛选
- ✅ 标签统计

### Full（+0.5 周）

- ✅ 智能标签建议
- ✅ 标签颜色和图标
- ✅ 标签合并
- ✅ 团队标签共享

---

## 5. 验收标准（Gherkin）

```gherkin
Feature: 任务标签系统

  Scenario: 添加标签
    Given 任务"API 优化"
    When 用户添加标签"后端"和"紧急"
    Then 任务应包含 2 个标签
    
  Scenario: 按标签筛选
    Given 有 50 个任务
    And 15 个任务标记为"紧急"
    When 用户筛选标签"紧急"
    Then 应显示 15 个任务
```

---

## 6. 成功指标

| 指标 | 目标值 |
|------|-------|
| 标签使用率 | >50% 任务有标签 |
| 标签筛选使用 | >30% 用户使用标签筛选 |
| 平均标签数 | 2-3 个/任务 |

---

**文档状态**: ✅ Ready for Review  
**下一步**: 继续 Reminder 模板功能

