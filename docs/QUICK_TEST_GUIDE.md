# 🧪 快速测试指南

## 问题 1：刷新后 KeyResult 消失 - 测试步骤

### 📋 测试场景
```
修复前的表现：刷新后看不到 KeyResult
修复后的表现：刷新后 KeyResult 正常显示
```

### ✅ 测试流程

```
1️⃣ 打开应用
  → 进入 Goal 列表

2️⃣ 点击某个 Goal 的 KeyResultCard
  → 进入 KeyResult 列表视图
  ✓ 验证：能看到多个 KeyResult 卡片

3️⃣ 点击某个 KeyResultCard
  → 进入 KeyResult 详情页
  ✓ 验证：看到 KeyResult 的详细信息
  ✓ 验证：看到进度记录列表

4️⃣ 按 F5 刷新浏览器
  ✓ 验证：看到加载动画（几秒钟）
  ✓ 验证：加载完成后 KeyResult 信息仍然显示
  ✓ 验证：记录列表仍然显示
  ✗ 不应该看到：错误信息或空白页面

5️⃣ 再次刷新（Ctrl+Shift+R 硬刷新）
  ✓ 验证：依然能正常显示（缓存已清空）
```

### 🔍 验证点

| 项目 | 预期 | 实际 | 状态 |
|------|------|------|------|
| F5 刷新后显示 KeyResult | ✓ | | |
| 显示 KeyResult 标题 | ✓ | | |
| 显示进度信息 | ✓ | | |
| 显示记录列表 | ✓ | | |
| 没有控制台错误 | ✓ | | |
| 加载速度 < 2 秒 | ✓ | | |

---

## 问题 2：删除 KeyResult - 测试步骤

### 📋 测试场景
```
功能需求：在 KeyResultCard 右下角添加删除按钮
预期效果：点击删除后确认删除，然后 KeyResult 从列表消失
```

### ✅ 测试流程

#### A. 在 KeyResult 列表页面删除

```
1️⃣ 进入 Goal 的 KeyResult 列表
  → 看到多个 KeyResult 卡片

2️⃣ 找到一个 KeyResultCard
  → 将鼠标悬停在卡片右下角
  ✓ 验证：看到两个按钮
    - 加号按钮（添加记录）
    - 红色删除按钮（垃圾桶图标）

3️⃣ 点击删除按钮
  ✓ 验证：出现确认对话框
  ✓ 对话框内容："确定要删除这个关键结果吗？此操作将同时删除所有关联的记录，无法撤销。"

4️⃣ 点击确认按钮
  ✓ 验证：看到加载动画
  ✓ 验证：看到成功提示："关键结果已删除"
  ✓ 验证：KeyResult 从列表中消失
  ✓ 验证：其他 KeyResult 保留不变

5️⃣ 点击某个 Goal 再返回
  ✓ 验证：刚删除的 KeyResult 真的消失了（不是隐藏）
  ✓ 验证：Goal 的 KeyResult 数量减少
```

#### B. 从 KeyResult 详情页删除（菜单）

```
1️⃣ 进入某个 KeyResult 的详情页

2️⃣ 点击顶部右侧的"更多"菜单（⋮）
  ✓ 验证：弹出菜单
  ✓ 验证：菜单中有"删除"选项

3️⃣ 点击"删除"
  ✓ 验证：出现确认对话框
  
4️⃣ 点击确认
  ✓ 验证：显示成功提示
  ✓ 验证：自动返回到 KeyResult 列表
  ✓ 验证：刚删除的 KeyResult 不在列表中
```

#### C. 不进行删除操作

```
1️⃣ 打开任何删除确认对话框

2️⃣ 点击"取消"或按 Esc
  ✓ 验证：对话框关闭
  ✓ 验证：KeyResult 没有被删除
  ✓ 验证：页面状态不变
```

### 🔍 验证点

| 项目 | 预期 | 实际 | 状态 |
|------|------|------|------|
| 删除按钮可见 | 悬停时显示 | | |
| 删除按钮样式 | 红色垃圾桶 | | |
| 确认对话框显示 | ✓ | | |
| 确认后删除成功 | ✓ | | |
| 成功提示显示 | ✓ | | |
| 列表自动更新 | ✓ | | |
| 数据库确实删除 | 刷新后仍无数据 | | |
| 取消操作生效 | ✓ | | |

---

## 组合测试

### 🎯 高级测试场景

#### 场景 1：删除后自动刷新

```
1. 在 KeyResult 列表删除一个 KeyResult
2. 在详情页打开/编辑其他记录
3. 返回列表
✓ 验证：被删除的 KeyResult 不在列表中
```

#### 场景 2：删除前后数据一致性

```
1. 记录 Goal 有 N 个 KeyResults
2. 删除一个 KeyResult
3. 点击 Goal 返回
4. 再次点击 Goal 进入
✓ 验证：KeyResult 数量从 N 减少到 N-1
```

#### 场景 3：多次刷新的稳定性

```
1. 进入 KeyResult 详情页
2. F5 刷新
3. 再次 F5 刷新
4. Ctrl+Shift+R 硬刷新
✓ 验证：每次都能正常显示内容
✓ 验证：没有间歇性错误
```

#### 场景 4：删除 KeyResult 后的记录处理

```
1. 某个 KeyResult 有 5 条记录
2. 删除这个 KeyResult
3. 从数据库查询相关记录
✓ 验证：相关记录也被删除（级联删除）
或
✓ 验证：相关记录被标记为已删除
```

---

## 🐛 故障排除

### 问题：F5 刷新后显示"未找到该关键结果"

**可能原因**：
- API 调用失败
- 路由参数不正确
- Goal 数据未完整加载

**调试步骤**：
```
1. 打开浏览器开发者工具 (F12)
2. 查看 Console 标签
3. 查看是否有错误消息
4. 查看 Network 标签
5. 确认 GET /api/goals/:goalUuid?includeChildren=true 返回了 keyResults
```

### 问题：删除按钮不显示

**可能原因**：
- 样式问题
- 按钮被隐藏
- 组件没有正确渲染

**调试步骤**：
```
1. F12 打开开发者工具
2. 用鼠标点击 KeyResult 卡片
3. 检查 Elements 标签
4. 找到 v-btn 标签
5. 查看是否有 class="delete-kr-btn"
6. 检查样式是否被正确应用
```

### 问题：删除后列表没有更新

**可能原因**：
- 自动刷新没有执行
- Pinia store 没有更新

**调试步骤**：
```
1. 删除一个 KeyResult
2. 打开 Console 查看是否有错误
3. 查看是否显示成功提示
4. 手动刷新页面（F5）检查数据是否真的被删除
```

---

## 📊 测试记录模板

```
测试日期：____年____月____日
测试人员：____________________
测试环境：浏览器 ____________，操作系统 ____________

问题 1：刷新后 KeyResult 消失
  [ ] 通过
  [ ] 失败
  失败原因：_________________________________
  
问题 2：删除 KeyResult 功能
  [ ] 通过
  [ ] 失败
  失败原因：_________________________________

综合评价：
  [ ] 全部通过，可以发布
  [ ] 部分功能有问题，需要修复
  [ ] 重大问题，不可发布

备注：_______________________________________
```

---

## ✨ 最佳实践

### 测试前检查清单

- [ ] 确认 API 服务器在运行
- [ ] 确认数据库连接正常
- [ ] 清空浏览器缓存（可选）
- [ ] 打开浏览器开发者工具（F12）
- [ ] 查看 Console 标签是否有警告

### 测试时的技巧

```
# 清空缓存刷新
Ctrl + Shift + R

# 打开开发者工具
F12

# 查看网络请求
F12 → Network 标签

# 查看控制台日志
F12 → Console 标签

# 查看元素结构
F12 → Elements 标签
```

