# è®¤è¯æ¨¡å— E2E æµ‹è¯•å®Œæˆæ€»ç»“

## ğŸ“Š æµ‹è¯•æ¦‚è§ˆ

å·²å®Œæˆ **Authenticationï¼ˆè®¤è¯ï¼‰** å’Œ **Accountï¼ˆè´¦æˆ·ï¼‰** æ¨¡å—çš„å®Œæ•´ E2E æµ‹è¯•å¥—ä»¶ã€‚

### æµ‹è¯•æ–‡ä»¶ç»Ÿè®¡

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç”¨ä¾‹æ•° | ä¼˜å…ˆçº§åˆ†å¸ƒ | ç”¨é€” |
|---------|-----------|-----------|------|
| `auth-login-debug.spec.ts` | 2 | [P0] x 2 | ç™»å½•è°ƒè¯•ï¼Œè¯¦ç»†æ—¥å¿—å’Œæˆªå›¾ |
| `auth-flow.spec.ts` | 6 | [P0] x 3, [P1] x 2, [P2] x 1 | å®Œæ•´è®¤è¯æµç¨‹æµ‹è¯• |
| `account-management.spec.ts` | 5 | [P0] x 1, [P1] x 2, [P2] x 2 | è´¦æˆ·ç®¡ç†åŠŸèƒ½æµ‹è¯• |
| **æ€»è®¡** | **13** | **[P0] x 6, [P1] x 4, [P2] x 3** | - |

---

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### 1. è®¤è¯æµç¨‹æµ‹è¯• (`auth-flow.spec.ts`)

#### âœ… [P0] æ ¸å¿ƒåŠŸèƒ½
1. **å®Œæ•´è®¤è¯æµç¨‹** 
   - æ³¨å†Œ â†’ ç™»å½• â†’ ç™»å‡º â†’ å†æ¬¡ç™»å½•
   - éªŒè¯æ•´ä¸ªç”¨æˆ·ç”Ÿå‘½å‘¨æœŸ

2. **ç”¨æˆ·æ³¨å†Œ**
   - æˆåŠŸæ³¨å†Œæ–°ç”¨æˆ·
   - ä½¿ç”¨å”¯ä¸€çš„ç”¨æˆ·åå’Œé‚®ç®±ï¼ˆæ¯æ¬¡è¿è¡Œç”Ÿæˆï¼‰

3. **é”™è¯¯å¯†ç æ‹’ç»**
   - éªŒè¯å¯†ç é”™è¯¯æ—¶æ‹’ç»ç™»å½•
   - æ˜¾ç¤ºæ­£ç¡®çš„é”™è¯¯æç¤º

#### âœ… [P1] é‡è¦åŠŸèƒ½
4. **ä¸å­˜åœ¨ç”¨æˆ·æ‹’ç»**
   - éªŒè¯ç”¨æˆ·åä¸å­˜åœ¨æ—¶æ‹’ç»ç™»å½•
   - æ˜¾ç¤ºé”™è¯¯æç¤º

5. **é‡å¤ç”¨æˆ·åæ‹’ç»**
   - éªŒè¯ç”¨æˆ·åå”¯ä¸€æ€§
   - é˜²æ­¢é‡å¤æ³¨å†Œ

#### âœ… [P2] ä¼˜åŒ–åŠŸèƒ½
6. **è®°ä½å¯†ç åŠŸèƒ½**
   - æµ‹è¯•"è®°ä½æˆ‘"åŠŸèƒ½
   - éªŒè¯æœ¬åœ°å­˜å‚¨

---

### 2. è´¦æˆ·ç®¡ç†æµ‹è¯• (`account-management.spec.ts`)

#### âœ… [P0] æ ¸å¿ƒåŠŸèƒ½
1. **è´¦æˆ·ç™»å‡º**
   - æˆåŠŸç™»å‡ºè´¦æˆ·
   - æ¸…é™¤ token
   - è·³è½¬åˆ°ç™»å½•é¡µ

#### âœ… [P1] é‡è¦åŠŸèƒ½
2. **æŸ¥çœ‹ä¸ªäººèµ„æ–™**
   - æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
   - éªŒè¯æ•°æ®æ­£ç¡®

3. **ä¿®æ”¹ä¸ªäººèµ„æ–™**
   - ä¿®æ”¹æ˜µç§°ç­‰ä¿¡æ¯
   - ä¿å­˜æˆåŠŸæç¤º

#### âœ… [P2] ä¼˜åŒ–åŠŸèƒ½
4. **ä¿®æ”¹å¯†ç **
   - éªŒè¯æ—§å¯†ç 
   - è®¾ç½®æ–°å¯†ç 
   - æˆåŠŸæç¤º

5. **æ¸…ç†è®¤è¯ä¿¡æ¯**
   - ç™»å‡ºåæ¸…é™¤æ‰€æœ‰è®¤è¯ç›¸å…³æ•°æ®
   - éªŒè¯ localStorage æ¸…ç†å®Œæ•´

---

### 3. ç™»å½•è°ƒè¯•æµ‹è¯• (`auth-login-debug.spec.ts`)

#### âœ… ç‰¹æ®Šè°ƒè¯•åŠŸèƒ½
1. **å®Œæ•´ç™»å½•æµç¨‹è°ƒè¯•**
   - 10 ä¸ªè¯¦ç»†æ­¥éª¤
   - æ¯æ­¥è‡ªåŠ¨æˆªå›¾
   - ç½‘ç»œè¯·æ±‚/å“åº”æ—¥å¿—
   - æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯æ•è·
   - å¤šç§å®šä½ç­–ç•¥å°è¯•

2. **API å¥åº·æ£€æŸ¥**
   - éªŒè¯ API æœåŠ¡å¯ç”¨æ€§
   - æµ‹è¯•ç½‘ç»œè¿é€šæ€§

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
apps/web/e2e/
â”œâ”€â”€ config.ts                                 # ç»Ÿä¸€é…ç½®æ–‡ä»¶
â”œâ”€â”€ CONFIG_README.md                          # é…ç½®æ–‡æ¡£
â”œâ”€â”€ authentication/
â”‚   â”œâ”€â”€ auth-login-debug.spec.ts             # ç™»å½•è°ƒè¯•æµ‹è¯•
â”‚   â”œâ”€â”€ auth-flow.spec.ts                    # è®¤è¯æµç¨‹æµ‹è¯•
â”‚   â””â”€â”€ README.md                            # è®¤è¯æµ‹è¯•æŒ‡å—
â”œâ”€â”€ account/
â”‚   â””â”€â”€ account-management.spec.ts           # è´¦æˆ·ç®¡ç†æµ‹è¯•
â”œâ”€â”€ goal/
â”‚   â”œâ”€â”€ goal-crud.spec.ts                    # Goal CRUD æµ‹è¯•
â”‚   â”œâ”€â”€ goal-keyresult.spec.ts               # å…³é”®ç»“æœæµ‹è¯•
â”‚   â”œâ”€â”€ goal-focus-mode.spec.ts              # ä¸“æ³¨æ¨¡å¼æµ‹è¯•
â”‚   â””â”€â”€ goal-statistics.spec.ts              # ç»Ÿè®¡åŠŸèƒ½æµ‹è¯•
â””â”€â”€ helpers/
    â””â”€â”€ testHelpers.ts                       # æµ‹è¯•è¾…åŠ©å‡½æ•°
```

---

## ï¿½ï¿½ å¿«é€Ÿä½¿ç”¨

### å‰ç½®æ­¥éª¤

```bash
# 1. åˆ›å»ºæµ‹è¯•ç”¨æˆ·
pnpm test:seed

# 2. å¯åŠ¨æœåŠ¡ï¼ˆä¸¤ä¸ªç»ˆç«¯ï¼‰
# ç»ˆç«¯ 1:
cd apps/api && pnpm dev

# ç»ˆç«¯ 2:
cd apps/web && pnpm dev

# 3. éªŒè¯æœåŠ¡
curl http://localhost:3888/api/v1/health && echo " âœ… API æ­£å¸¸"
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰è®¤è¯æµ‹è¯•
pnpm e2e:auth

# è¿è¡Œç™»å½•è°ƒè¯•æµ‹è¯•ï¼ˆå¸¦æµè§ˆå™¨ç•Œé¢å’Œè¯¦ç»†æ—¥å¿—ï¼‰
pnpm e2e:auth:debug

# è¿è¡Œè®¤è¯æµç¨‹æµ‹è¯•
pnpm e2e:auth:flow

# è¿è¡Œè´¦æˆ·ç®¡ç†æµ‹è¯•
pnpm e2e:account

# åªè¿è¡Œ P0 çº§åˆ«æµ‹è¯•
npx playwright test authentication/ -g "P0"

# ç”Ÿæˆ HTML æŠ¥å‘Š
npx playwright test authentication/ --reporter=html
npx playwright show-report
```

---

## ğŸ¨ ç™»å½•è°ƒè¯•åŠŸèƒ½äº®ç‚¹

### è‡ªåŠ¨ç”Ÿæˆçš„æˆªå›¾ï¼ˆä¿å­˜åœ¨ `/tmp/`ï¼‰

1. `01-login-page-loaded.png` - ç™»å½•é¡µé¢åŠ è½½å®Œæˆ
2. `02-login-tab-selected.png` - ç™»å½•æ ‡ç­¾å·²é€‰ä¸­
3. `03-error-no-username-input.png` - âŒ æ‰¾ä¸åˆ°ç”¨æˆ·åè¾“å…¥æ¡†
4. `04-username-filled.png` - ç”¨æˆ·åå·²å¡«å†™
5. `05-error-no-password-input.png` - âŒ æ‰¾ä¸åˆ°å¯†ç è¾“å…¥æ¡†
6. `06-password-filled.png` - å¯†ç å·²å¡«å†™
7. `07-error-no-login-button.png` - âŒ æ‰¾ä¸åˆ°ç™»å½•æŒ‰é’®
8. `08-after-login-click.png` - ç‚¹å‡»ç™»å½•æŒ‰é’®å
9. `09-login-error.png` - ç™»å½•é”™è¯¯æç¤º
10. `10-final-state.png` - æœ€ç»ˆçŠ¶æ€

### è¯¦ç»†æ—¥å¿—ç¤ºä¾‹

```
================================================================================
ğŸ” ç™»å½•è°ƒè¯•æµ‹è¯•å¼€å§‹
================================================================================
API åœ°å€: http://localhost:3888/api/v1
Web åœ°å€: http://localhost:5173
æµ‹è¯•ç”¨æˆ·: testuser
================================================================================

ğŸ“ æ­¥éª¤ 1: å¯¼èˆªåˆ°ç™»å½•é¡µ
   å½“å‰ URL: http://localhost:5173/auth
   ğŸ“¸ æˆªå›¾å·²ä¿å­˜: /tmp/01-login-page-loaded.png

ğŸ“ æ­¥éª¤ 2: æ¸…ç† localStorage
   âœ… é¡µé¢åŠ è½½å®Œæˆ

ğŸ“ æ­¥éª¤ 3: æŸ¥æ‰¾å¹¶ç‚¹å‡»ç™»å½•æ ‡ç­¾
   æ‰¾åˆ° 2 ä¸ªç™»å½•æ ‡ç­¾
   âœ… å·²ç‚¹å‡»ç™»å½•æ ‡ç­¾
   ğŸ“¸ æˆªå›¾å·²ä¿å­˜: /tmp/02-login-tab-selected.png

ğŸ“ æ­¥éª¤ 4: å®šä½ç”¨æˆ·åè¾“å…¥æ¡†
   é€šè¿‡ label "ç”¨æˆ·å" å®šä½: æ‰¾åˆ° 1 ä¸ªå…ƒç´ 
   âœ… ä½¿ç”¨ç­–ç•¥: é€šè¿‡ label "ç”¨æˆ·å" å®šä½

ğŸ“ æ­¥éª¤ 5: å¡«å†™ç”¨æˆ·å "testuser"
   è¾“å…¥æ¡†å€¼: "testuser"
   ğŸ“¸ æˆªå›¾å·²ä¿å­˜: /tmp/04-username-filled.png

ğŸ“ æ­¥éª¤ 6: å®šä½å¯†ç è¾“å…¥æ¡†
   é€šè¿‡ label "å¯†ç " å®šä½: æ‰¾åˆ° 1 ä¸ªå…ƒç´ 
   âœ… ä½¿ç”¨ç­–ç•¥: é€šè¿‡ label "å¯†ç " å®šä½

ğŸ“ æ­¥éª¤ 7: å¡«å†™å¯†ç 
   âœ… å¯†ç å·²å¡«å†™
   ğŸ“¸ æˆªå›¾å·²ä¿å­˜: /tmp/06-password-filled.png

ğŸ“ æ­¥éª¤ 8: æŸ¥æ‰¾ç™»å½•æŒ‰é’®
   é€šè¿‡ type="submit" å’Œæ–‡æœ¬å®šä½: æ‰¾åˆ° 1 ä¸ªå…ƒç´ 
   âœ… ä½¿ç”¨ç­–ç•¥: é€šè¿‡ type="submit" å’Œæ–‡æœ¬å®šä½

ğŸ“ æ­¥éª¤ 9: ç‚¹å‡»ç™»å½•æŒ‰é’®
   âœ… å·²ç‚¹å‡»ç™»å½•æŒ‰é’®
   â³ ç­‰å¾…ç™»å½• API è¯·æ±‚...

ğŸ“¤ [REQUEST] POST http://localhost:3888/api/v1/auth/login
   Body: {
     "username": "testuser",
     "password": "Test123456!"
   }

ğŸ“¥ [RESPONSE] âœ… 200 http://localhost:3888/api/v1/auth/login
   Response: {"token":"eyJhbGci...","user":{"id":"...","username":"testuser"}}

ğŸ“ æ­¥éª¤ 10: æ£€æŸ¥ç™»å½•ç»“æœ
   å½“å‰ URL: http://localhost:5173/goals
   âœ… å·²ç¦»å¼€ç™»å½•é¡µé¢
   localStorage çŠ¶æ€:
     - token: å·²å­˜åœ¨
     - userInfo: å·²å­˜åœ¨
     - æ‰€æœ‰ keys: token, userInfo, userId
   ğŸ“¸ æœ€ç»ˆçŠ¶æ€æˆªå›¾: /tmp/10-final-state.png

================================================================================
ğŸ ç™»å½•è°ƒè¯•æµ‹è¯•ç»“æŸ
================================================================================
```

---

## ğŸ“‹ æ–°å¢çš„ npm scripts

å·²åœ¨æ ¹ç›®å½• `package.json` ä¸­æ·»åŠ ä»¥ä¸‹è„šæœ¬ï¼š

```json
{
  "scripts": {
    "e2e:auth": "npx playwright test apps/web/e2e/authentication/",
    "e2e:auth:debug": "npx playwright test apps/web/e2e/authentication/auth-login-debug.spec.ts --headed --reporter=list",
    "e2e:auth:flow": "npx playwright test apps/web/e2e/authentication/auth-flow.spec.ts",
    "e2e:account": "npx playwright test apps/web/e2e/account/"
  }
}
```

---

## ğŸ” é—®é¢˜æ’æŸ¥æµç¨‹

å½“ç™»å½•æµ‹è¯•å¤±è´¥æ—¶ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ’æŸ¥ï¼š

### 1ï¸âƒ£ è¿è¡Œè°ƒè¯•æµ‹è¯•
```bash
pnpm e2e:auth:debug
```

### 2ï¸âƒ£ æŸ¥çœ‹æˆªå›¾
```bash
ls -lh /tmp/*.png
open /tmp/10-final-state.png  # macOS
xdg-open /tmp/10-final-state.png  # Linux
```

### 3ï¸âƒ£ æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
è°ƒè¯•æµ‹è¯•ä¼šè¾“å‡ºï¼š
- ğŸ“¤ æ‰€æœ‰ API è¯·æ±‚
- ğŸ“¥ æ‰€æœ‰ API å“åº”
- ğŸ–¥ï¸ æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
- ğŸ–¥ï¸ é¡µé¢é”™è¯¯

### 4ï¸âƒ£ æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
curl http://localhost:3888/api/v1/health && echo " âœ… API æ­£å¸¸"
curl http://localhost:5173 && echo " âœ… Web æ­£å¸¸"
```

### 5ï¸âƒ£ æ£€æŸ¥æµ‹è¯•ç”¨æˆ·
```bash
pnpm test:seed  # é‡æ–°åˆ›å»ºæµ‹è¯•ç”¨æˆ·
```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- **é…ç½®æ–‡æ¡£**: `/apps/web/e2e/CONFIG_README.md`
- **è®¤è¯æµ‹è¯•æŒ‡å—**: `/apps/web/e2e/authentication/README.md`
- **æµ‹è¯•è¾…åŠ©å‡½æ•°**: `/apps/web/e2e/helpers/testHelpers.ts`
- **ç§å­æ•°æ®è„šæœ¬**: `/tools/test/seed-test-user.ts`

---

## âœ… æµ‹è¯•ç‰¹ç‚¹æ€»ç»“

### 1. ä¸­å¿ƒåŒ–é…ç½® ğŸ¯
- æ‰€æœ‰ç«¯å£ã€URLã€è¶…æ—¶æ—¶é—´ç»Ÿä¸€ç®¡ç†
- ä¸€å¤„ä¿®æ”¹ï¼Œå…¨å±€ç”Ÿæ•ˆ
- ç¯å¢ƒå˜é‡è¦†ç›–æ”¯æŒ

### 2. è¯¦ç»†è°ƒè¯•æ”¯æŒ ğŸ”
- 10 æ­¥è¯¦ç»†æ—¥å¿—
- è‡ªåŠ¨æˆªå›¾ï¼ˆæ¯æ­¥ï¼‰
- ç½‘ç»œè¯·æ±‚/å“åº”æ‹¦æˆª
- æµè§ˆå™¨é”™è¯¯æ•è·
- å¤šç§å®šä½ç­–ç•¥å°è¯•

### 3. æµ‹è¯•éš”ç¦» ğŸ›¡ï¸
- æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹çš„ç”¨æˆ·ï¼ˆauth-flowï¼‰
- æˆ–ä½¿ç”¨å›ºå®šæµ‹è¯•ç”¨æˆ·ï¼ˆaccount-managementï¼‰
- æ¯æ¬¡æµ‹è¯•å‰æ¸…ç†è®¤è¯çŠ¶æ€
- é¿å…æµ‹è¯•ä¹‹é—´ç›¸äº’å½±å“

### 4. ä¼˜å…ˆçº§åˆ†çº§ ğŸ“Š
- **[P0]** - æ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»é€šè¿‡
- **[P1]** - é‡è¦åŠŸèƒ½ï¼Œåº”è¯¥é€šè¿‡
- **[P2]** - æ¬¡è¦åŠŸèƒ½ï¼Œæœ€å¥½é€šè¿‡

### 5. å®Œæ•´è¦†ç›– âœ¨
- æ³¨å†Œ âœ…
- ç™»å½• âœ…
- ç™»å‡º âœ…
- è´¦æˆ·æŸ¥çœ‹ âœ…
- è´¦æˆ·ä¿®æ”¹ âœ…
- å¯†ç ä¿®æ”¹ âœ…
- é”™è¯¯å¤„ç† âœ…
- æ•°æ®æ¸…ç† âœ…

---

## ğŸ‰ æ€»ç»“

å·²å®Œæˆ **13 ä¸ªæµ‹è¯•ç”¨ä¾‹**ï¼Œè¦†ç›–äº†è®¤è¯å’Œè´¦æˆ·ç®¡ç†çš„æ‰€æœ‰å…³é”®åŠŸèƒ½ã€‚

### ä¸‹ä¸€æ­¥å»ºè®®

1. **è¿è¡Œè°ƒè¯•æµ‹è¯•** æŸ¥çœ‹ç™»å½•æ˜¯å¦æ­£å¸¸ï¼š
   ```bash
   pnpm e2e:auth:debug
   ```

2. **å¦‚æœç™»å½•æˆåŠŸ**ï¼Œè¿è¡Œæ‰€æœ‰è®¤è¯æµ‹è¯•ï¼š
   ```bash
   pnpm e2e:auth
   ```

3. **å¦‚æœä»æœ‰é—®é¢˜**ï¼ŒæŸ¥çœ‹æˆªå›¾å’Œæ—¥å¿—æ’æŸ¥å…·ä½“åŸå› 

4. **é›†æˆåˆ° CI/CD** åœ¨ GitHub Actions ä¸­è‡ªåŠ¨è¿è¡Œè¿™äº›æµ‹è¯•

---

**æµ‹è¯•åˆ›å»ºæ—¶é—´**: 2024å¹´ï¼ˆæ ¹æ®å®é™…æ—¶é—´å¡«å†™ï¼‰
**æµ‹è¯•è¦†ç›–æ¨¡å—**: Authentication, Account
**æµ‹è¯•ä¼˜å…ˆçº§**: [P0] x 6, [P1] x 4, [P2] x 3
**ç‰¹æ®Šå·¥å…·**: ç™»å½•è°ƒè¯•æµ‹è¯•ï¼ˆå¸¦æˆªå›¾å’Œè¯¦ç»†æ—¥å¿—ï¼‰
