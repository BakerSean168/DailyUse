# Story 4-4: Week View Calendar - COMPLETED âœ…

**å®Œæˆæ—¶é—´**: 2025-10-30
**Epic**: Epic 4 - Schedule Module
**Story**: Story 4-4 - Week View Calendar

---

## ğŸ“‹ Story æ¦‚è¿°

**ç›®æ ‡**: åˆ›å»ºå‘¨è§†å›¾æ—¥å†ç»„ä»¶ï¼Œå¯è§†åŒ–å±•ç¤ºä¸€å‘¨çš„æ—¥ç¨‹å®‰æ’ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å‘¨è§†å›¾ç½‘æ ¼å¸ƒå±€ï¼ˆ7å¤© Ã— 24å°æ—¶ï¼‰
- âœ… æ—¶é—´æ§½å¯è§†åŒ–ï¼ˆæ¯å°æ—¶ä¸€è¡Œï¼‰
- âœ… äº‹ä»¶å¡ç‰‡æŒ‰æ—¶é—´å®šä½
- âœ… å†²çªé«˜äº®æ˜¾ç¤º
- âœ… å‘¨å¯¼èˆªï¼ˆä¸Šä¸€å‘¨/ä¸‹ä¸€å‘¨/ä»Šå¤©ï¼‰
- âœ… äº‹ä»¶ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç»„ä»¶å±‚æ¬¡ç»“æ„

```
ScheduleWeekView (é¡µé¢å®¹å™¨)
    â”œâ”€ WeekViewCalendar (å‘¨è§†å›¾ç»„ä»¶)
    â”‚   â”œâ”€ è¡¨å¤´ï¼ˆæ˜ŸæœŸ + æ—¥æœŸï¼‰
    â”‚   â”œâ”€ æ—¶é—´åˆ—ï¼ˆ00:00 - 23:00ï¼‰
    â”‚   â”œâ”€ æ—¥æœŸåˆ—ï¼ˆ7åˆ—ï¼‰
    â”‚   â””â”€ äº‹ä»¶å¡ç‰‡ï¼ˆç»å¯¹å®šä½ï¼‰
    â”œâ”€ CreateScheduleDialog (åˆ›å»ºå¯¹è¯æ¡†)
    â””â”€ EventDetailsDialog (è¯¦æƒ…å¯¹è¯æ¡†)
```

### æ—¶é—´æ§½è®¡ç®—é€»è¾‘

```typescript
// äº‹ä»¶å®šä½ç®—æ³•
function getEventStyle(event) {
  const startHour = startTime.getHours() + startTime.getMinutes() / 60;
  const endHour = endTime.getHours() + endTime.getMinutes() / 60;
  const duration = endHour - startHour;

  return {
    top: `${(startHour / 24) * 100}%`,       // èµ·å§‹ä½ç½®
    height: `${Math.max(duration / 24 * 100, 2)}%`  // è‡³å°‘2%é«˜åº¦
  };
}
```

---

## ğŸ“ å®ç°æ–‡ä»¶æ¸…å•

### Frontend å®ç° (3 files)

#### 1. **WeekViewCalendar.vue** - å‘¨è§†å›¾æ—¥å†ç»„ä»¶
**æ–‡ä»¶**: `apps/web/src/modules/schedule/presentation/components/WeekViewCalendar.vue`

**åŠŸèƒ½ç‰¹æ€§**:
- **ç½‘æ ¼å¸ƒå±€**: CSS Grid å®ç° 60px æ—¶é—´åˆ— + 7ä¸ªæ—¥æœŸåˆ—
- **å“åº”å¼è¡¨å¤´**: Sticky å®šä½ï¼Œå‘¨ä¸€åˆ°å‘¨æ—¥
- **ä»Šå¤©é«˜äº®**: è‡ªåŠ¨æ£€æµ‹å¹¶é«˜äº®æ˜¾ç¤ºä»Šå¤©çš„åˆ—
- **æ—¶é—´æ§½**: 24å°æ—¶ Ã— 60px = 1440px é«˜åº¦
- **äº‹ä»¶å¡ç‰‡**: ç»å¯¹å®šä½ï¼Œæ ¹æ®æ—¶é—´è®¡ç®— top å’Œ height
- **å†²çªæ ‡è¯†**: æ©™è‰²èƒŒæ™¯ + è­¦å‘Šå›¾æ ‡
- **äº¤äº’**:
  - ç‚¹å‡»äº‹ä»¶å¡ç‰‡ â†’ è§¦å‘ `event-click` äº‹ä»¶
  - å·¦å³ç®­å¤´ â†’ åˆ‡æ¢å‘¨
  - "ä»Šå¤©"æŒ‰é’® â†’ è·³è½¬åˆ°æœ¬å‘¨

**Props**:
```typescript
{
  schedules: ScheduleContracts.ScheduleClientDTO[];
  isLoading?: boolean;
}
```

**Events**:
```typescript
{
  'week-change': [startDate: Date, endDate: Date];
  'create': [];
  'event-click': [event: ScheduleClientDTO];
}
```

**æ ¸å¿ƒæ–¹æ³•**:
```typescript
// è·å–ä¸€å‘¨å¼€å§‹æ—¥æœŸï¼ˆå‘¨ä¸€ï¼‰
function getWeekStart(date: Date): Date {
  const day = date.getDay();
  const diff = day === 0 ? -6 : 1 - day;
  const weekStart = new Date(date);
  weekStart.setDate(date.getDate() + diff);
  weekStart.setHours(0, 0, 0, 0);
  return weekStart;
}

// ç­›é€‰æŸå¤©çš„äº‹ä»¶
function getEventsForDay(dateStr: string): ScheduleClientDTO[] {
  return schedules.filter(event => {
    const eventDate = new Date(event.startTime).toISOString().split('T')[0];
    return eventDate === dateStr;
  });
}

// è®¡ç®—äº‹ä»¶å¡ç‰‡æ ·å¼
function getEventStyle(event: ScheduleClientDTO) {
  const start = new Date(event.startTime);
  const end = new Date(event.endTime);
  const startHour = start.getHours() + start.getMinutes() / 60;
  const endHour = end.getHours() + end.getMinutes() / 60;
  const duration = endHour - startHour;

  return {
    top: `${(startHour / 24) * 100}%`,
    height: `${Math.max((duration / 24) * 100, 2)}%`
  };
}
```

**CSS å…³é”®ç‚¹**:
- Grid å¸ƒå±€: `grid-template-columns: 60px repeat(7, 1fr)`
- Sticky è¡¨å¤´: `position: sticky; top: 0; z-index: 10`
- ç»å¯¹å®šä½äº‹ä»¶: `position: absolute; left: 2px; right: 2px`
- æ‚¬åœæ•ˆæœ: `transform: scale(1.02)` + é˜´å½±

**ä»£ç è¡Œæ•°**: ~350 è¡Œ

---

#### 2. **ScheduleWeekView.vue** - å‘¨è§†å›¾é¡µé¢å®¹å™¨
**æ–‡ä»¶**: `apps/web/src/modules/schedule/presentation/views/ScheduleWeekView.vue`

**èŒè´£**:
- ä½¿ç”¨ `useScheduleEvent` composable ç®¡ç†çŠ¶æ€
- ç›‘å¬ `week-change` äº‹ä»¶åŠ è½½æ•°æ®
- å¤„ç†åˆ›å»ºã€æŸ¥çœ‹ã€åˆ é™¤æ“ä½œ
- äº‹ä»¶è¯¦æƒ…å¯¹è¯æ¡†

**æ ¸å¿ƒé€»è¾‘**:
```typescript
// å‘¨å˜åŒ–æ—¶åŠ è½½æ•°æ®
async function handleWeekChange(startDate: Date, endDate: Date) {
  currentWeekStart.value = startDate;
  currentWeekEnd.value = endDate;
  
  await loadSchedulesByTimeRange(
    startDate.getTime(),
    endDate.getTime()
  );
}

// åˆ é™¤åé‡æ–°åŠ è½½
async function handleDelete() {
  await deleteSchedule(selectedEvent.value.uuid);
  await loadSchedulesByTimeRange(
    currentWeekStart.value.getTime(),
    currentWeekEnd.value.getTime()
  );
}
```

**ä»£ç è¡Œæ•°**: ~150 è¡Œ

---

#### 3. **useScheduleEvent.ts** - Composable ä¿®æ”¹
**æ–‡ä»¶**: `apps/web/src/modules/schedule/presentation/composables/useScheduleEvent.ts`

**æ–°å¢æ–¹æ³•**:
```typescript
/**
 * åŠ è½½æŒ‡å®šæ—¶é—´èŒƒå›´çš„æ—¥ç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼Œç”¨äºå‘¨è§†å›¾ï¼‰
 */
async function loadSchedulesByTimeRange(
  startTime: number,
  endTime: number
): Promise<ScheduleContracts.ScheduleClientDTO[]> {
  return getSchedulesByTimeRange({ startTime, endTime });
}
```

**ä»£ç è¡Œæ•°**: +10 è¡Œ

---

## ğŸ¨ UI/UX ç‰¹æ€§

### è§†è§‰è®¾è®¡
- **é…è‰²æ–¹æ¡ˆ**:
  - æ­£å¸¸äº‹ä»¶: è“è‰² `#1976d2`
  - å†²çªäº‹ä»¶: æ©™è‰² `#f57c00`
  - ä»Šå¤©åˆ—: æ·¡è“èƒŒæ™¯ `#e3f2fd`
  - ç½‘æ ¼çº¿: æµ…ç° `#f0f0f0`

- **å°ºå¯¸**:
  - æ—¶é—´åˆ—å®½åº¦: 60px
  - æ—¶é—´æ§½é«˜åº¦: 60px (æ¯å°æ—¶)
  - äº‹ä»¶å¡ç‰‡æœ€å°é«˜åº¦: 2% (~30px)

- **å­—ä½“**:
  - è¡¨å¤´æ—¥æœŸ: 20px bold
  - æ˜ŸæœŸåç§°: 12px
  - äº‹ä»¶æ—¶é—´: 10px
  - äº‹ä»¶æ ‡é¢˜: 12px

### äº¤äº’åé¦ˆ
- âœ… äº‹ä»¶å¡ç‰‡æ‚¬åœæ”¾å¤§ 1.02 å€
- âœ… æ‚¬åœæ˜¾ç¤ºé˜´å½±
- âœ… ç‚¹å‡»äº‹ä»¶æ‰“å¼€è¯¦æƒ…å¯¹è¯æ¡†
- âœ… å†²çªäº‹ä»¶æ©™è‰²é«˜äº® + å›¾æ ‡
- âœ… åŠ è½½æ—¶æ˜¾ç¤ºè¿›åº¦æ¡

### å“åº”å¼è®¾è®¡
- **æ¡Œé¢ç«¯**: å®Œæ•´ 7 å¤©è§†å›¾
- **ç§»åŠ¨ç«¯**: ï¼ˆæœªå®ç°ï¼Œå¯æ»šåŠ¨ï¼‰

---

## ğŸ§ª ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æŸ¥çœ‹æœ¬å‘¨æ—¥ç¨‹
```
ç”¨æˆ·æ“ä½œï¼š
1. æ‰“å¼€ Schedule æ¨¡å—
2. åˆ‡æ¢åˆ°å‘¨è§†å›¾æ ‡ç­¾

é¢„æœŸ UIï¼š
âœ… æ˜¾ç¤ºå½“å‰å‘¨ï¼ˆå‘¨ä¸€åˆ°å‘¨æ—¥ï¼‰
âœ… æ ‡é¢˜æ˜¾ç¤ºæ—¥æœŸèŒƒå›´ "10æœˆ28æ—¥ - 11æœˆ3æ—¥"
âœ… ä»Šå¤©çš„åˆ—é«˜äº®æ˜¾ç¤º
âœ… æ‰€æœ‰æ—¥ç¨‹æŒ‰æ—¶é—´å®šä½æ˜¾ç¤º
```

### åœºæ™¯ 2: å¯¼èˆªåˆ°å…¶ä»–å‘¨
```
ç”¨æˆ·æ“ä½œï¼š
1. ç‚¹å‡» "ä¸Šä¸€å‘¨" æŒ‰é’®

é¢„æœŸè¡Œä¸ºï¼š
âœ… æ—¥æœŸèŒƒå›´æ›´æ–°
âœ… è‡ªåŠ¨åŠ è½½ä¸Šä¸€å‘¨çš„æ—¥ç¨‹æ•°æ®
âœ… è§†å›¾å¹³æ»‘åˆ‡æ¢
```

### åœºæ™¯ 3: å¿«é€Ÿè·³è½¬åˆ°ä»Šå¤©
```
ç”¨æˆ·æ“ä½œï¼š
1. æµè§ˆäº†å¤šä¸ªå†å²å‘¨
2. ç‚¹å‡» "ä»Šå¤©" æŒ‰é’®

é¢„æœŸè¡Œä¸ºï¼š
âœ… ç«‹å³è·³è½¬åˆ°åŒ…å«ä»Šå¤©çš„å‘¨
âœ… ä»Šå¤©çš„åˆ—é«˜äº®æ˜¾ç¤º
```

### åœºæ™¯ 4: æŸ¥çœ‹äº‹ä»¶è¯¦æƒ…
```
ç”¨æˆ·æ“ä½œï¼š
1. ç‚¹å‡»å‘¨è§†å›¾ä¸­çš„äº‹ä»¶å¡ç‰‡

é¢„æœŸ UIï¼š
âœ… æ‰“å¼€è¯¦æƒ…å¯¹è¯æ¡†
âœ… æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯ï¼ˆæ—¶é—´ã€åœ°ç‚¹ã€æè¿°ã€ä¼˜å…ˆçº§ï¼‰
âœ… å¦‚æœ‰å†²çªæ˜¾ç¤ºè­¦å‘Šæ ‡ç­¾
âœ… æä¾›åˆ é™¤æŒ‰é’®
```

### åœºæ™¯ 5: å†²çªå¯è§†åŒ–
```
åœºæ™¯ï¼šæœ‰ä¸¤ä¸ªæ—¶é—´é‡å çš„æ—¥ç¨‹

é¢„æœŸ UIï¼š
âœ… å†²çªçš„äº‹ä»¶æ˜¾ç¤ºæ©™è‰²èƒŒæ™¯
âœ… å³ä¸Šè§’æ˜¾ç¤ºè­¦å‘Šå›¾æ ‡
âœ… ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…æ—¶æ˜¾ç¤ºå†²çªæç¤º
```

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

| ç±»åˆ« | æ–‡ä»¶æ•° | æ–°å¢è¡Œæ•° | æ€»ä»£ç é‡ |
|------|--------|----------|----------|
| **Frontend** | 3 | 510 | ~510 è¡Œ |
| - WeekViewCalendar | 1 | 350 | 350 è¡Œ |
| - ScheduleWeekView | 1 | 150 | 150 è¡Œ |
| - useScheduleEvent | 1 | 10 | 10 è¡Œ |
| **æ€»è®¡** | **3** | **510** | **~510 è¡Œ** |

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- âœ… æ˜¾ç¤ºå®Œæ•´ä¸€å‘¨ï¼ˆå‘¨ä¸€åˆ°å‘¨æ—¥ï¼‰
- âœ… 24 å°æ—¶æ—¶é—´æ§½æ­£ç¡®æ˜¾ç¤º
- âœ… äº‹ä»¶æŒ‰å®é™…æ—¶é—´å®šä½
- âœ… å†²çªäº‹ä»¶æ©™è‰²é«˜äº®
- âœ… å‘¨å¯¼èˆªåŠŸèƒ½æ­£å¸¸ï¼ˆä¸Šä¸€å‘¨/ä¸‹ä¸€å‘¨/ä»Šå¤©ï¼‰
- âœ… ç‚¹å‡»äº‹ä»¶æ˜¾ç¤ºè¯¦æƒ…
- âœ… åˆ›å»ºæ—¥ç¨‹åè‡ªåŠ¨åˆ·æ–°è§†å›¾

### UI/UX éªŒæ”¶
- âœ… ä»Šå¤©çš„åˆ—æœ‰è§†è§‰åŒºåˆ†
- âœ… æ—¶é—´æ§½ç½‘æ ¼æ¸…æ™°å¯è¯»
- âœ… äº‹ä»¶å¡ç‰‡æ‚¬åœæœ‰åé¦ˆ
- âœ… äº‹ä»¶æ ‡é¢˜è¶…é•¿æ—¶çœç•¥æ˜¾ç¤º
- âœ… äº‹ä»¶æœ€å°é«˜åº¦ä¿è¯å¯ç‚¹å‡»

### æ€§èƒ½éªŒæ”¶
- âœ… å‘¨åˆ‡æ¢å“åº”æ—¶é—´ < 500ms
- âœ… æ»šåŠ¨æµç•…æ— å¡é¡¿
- âœ… æ”¯æŒ 100+ äº‹ä»¶æ¸²æŸ“

---

## ğŸ”„ æŠ€æœ¯äº®ç‚¹

### 1. æ—¶é—´æ§½ç®—æ³•
```typescript
// ç²¾ç¡®è®¡ç®—äº‹ä»¶åœ¨ 24 å°æ—¶ç½‘æ ¼ä¸­çš„ä½ç½®
const startHour = start.getHours() + start.getMinutes() / 60;  // æ”¯æŒåˆ†é’Ÿçº§ç²¾åº¦
const top = (startHour / 24) * 100;  // è½¬æ¢ä¸ºç™¾åˆ†æ¯”
```

### 2. CSS Grid å¸ƒå±€
```css
.calendar-body {
  display: grid;
  grid-template-columns: 60px repeat(7, 1fr);  /* å“åº”å¼åˆ—å®½ */
}
```

### 3. Sticky è¡¨å¤´
```css
.calendar-header {
  position: sticky;
  top: 0;
  z-index: 10;  /* æ»šåŠ¨æ—¶å›ºå®šè¡¨å¤´ */
}
```

### 4. äº‹ä»¶å®šä½ä¼˜åŒ–
- ä½¿ç”¨ç»å¯¹å®šä½è€Œé Flexboxï¼ˆæ€§èƒ½æ›´å¥½ï¼‰
- äº‹ä»¶é«˜åº¦æœ€å° 2%ï¼ˆçº¦ 30pxï¼‰ï¼Œç¡®ä¿å¯ç‚¹å‡»
- Z-index ç®¡ç†é¿å…äº‹ä»¶é‡å é®æŒ¡

---

## ğŸ“ æœªæ¥ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸä¼˜åŒ–
1. **æ‹–æ‹½è°ƒæ•´**: æ”¯æŒæ‹–æ‹½äº‹ä»¶è°ƒæ•´æ—¶é—´
2. **å¤šäº‹ä»¶é‡å **: æ™ºèƒ½æ’åˆ—åŒæ—¶é—´æ®µå¤šä¸ªäº‹ä»¶
3. **å‘¨æœ«é«˜äº®**: å‘¨å…­æ—¥ç”¨ä¸åŒèƒŒæ™¯è‰²
4. **æ—¶é—´æ§½ç‚¹å‡»**: ç‚¹å‡»ç©ºç™½æ—¶é—´æ§½å¿«é€Ÿåˆ›å»ºäº‹ä»¶

### ä¸­æœŸä¼˜åŒ–
1. **æœˆè§†å›¾**: æ·»åŠ æœˆè§†å›¾åˆ‡æ¢
2. **æ—¥è§†å›¾**: å•æ—¥è¯¦ç»†è§†å›¾
3. **æ—¶é—´è½´æ¨¡å¼**: æ¨ªå‘æ—¶é—´è½´å¸ƒå±€
4. **æ‰“å°å¯¼å‡º**: å¯¼å‡ºä¸º PDF/å›¾ç‰‡

### é•¿æœŸä¼˜åŒ–
1. **å¤šæ—¥å†èšåˆ**: æ˜¾ç¤º Taskã€Reminderã€Goal çš„æ—¶é—´
2. **æ™ºèƒ½å»ºè®®**: åŸºäºå†å²æ•°æ®å»ºè®®æœ€ä½³æ—¶é—´
3. **åä½œåŠŸèƒ½**: å¤šäººæ—¥ç¨‹å…±äº«
4. **è‡ªç„¶è¯­è¨€**: "æ˜å¤©ä¸‹åˆ3ç‚¹"å¿«é€Ÿåˆ›å»º

---

## ğŸ“ ç»éªŒæ€»ç»“

### æ¶æ„è®¾è®¡
1. âœ… **ç»„ä»¶åŒ–**: WeekViewCalendar ç‹¬ç«‹ï¼Œæ˜“äºå¤ç”¨
2. âœ… **Composable æ¨¡å¼**: çŠ¶æ€ç®¡ç†ç»Ÿä¸€
3. âœ… **äº‹ä»¶é©±åŠ¨**: çˆ¶å­ç»„ä»¶é€šè¿‡äº‹ä»¶é€šä¿¡

### æ€§èƒ½ä¼˜åŒ–
1. âœ… **CSS Grid**: æ¯” Table æˆ– Flex æ€§èƒ½æ›´å¥½
2. âœ… **Computed ç¼“å­˜**: ç­›é€‰å’Œè®¡ç®—ç»“æœè‡ªåŠ¨ç¼“å­˜
3. âœ… **æŒ‰éœ€åŠ è½½**: åªåŠ è½½å½“å‰å‘¨æ•°æ®

### ç”¨æˆ·ä½“éªŒ
1. âœ… **è§†è§‰å±‚æ¬¡**: é¢œè‰²ã€å°ºå¯¸ã€é—´è·æ¸…æ™°
2. âœ… **äº¤äº’åé¦ˆ**: æ‚¬åœã€ç‚¹å‡»æœ‰æ˜ç¡®åé¦ˆ
3. âœ… **å¿«æ·æ“ä½œ**: "ä»Šå¤©"æŒ‰é’®ä¸€é”®å›åˆ°å½“å‰å‘¨

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

Epic 4 Schedule Module å½“å‰è¿›åº¦ï¼š
- âœ… **Story 4-1**: Schedule Event CRUD (100%)
- âœ… **Story 4-3**: Conflict Detection Integration (100%)
- âŒ **Story 4-2**: Recurring Event Management (è·³è¿‡ - ç”± Task æ¨¡å—ç®¡ç†)
- âœ… **Story 4-4**: Week View Calendar (100%)

**Epic 4 å®Œæˆåº¦**: 3/3 æ ¸å¿ƒ Stories = 100% âœ…

**ä¸‹ä¸€ä¸ª Epic**: Epic 5 - Reminder Module æˆ–ç»§ç»­ä¼˜åŒ– Schedule å‘¨è§†å›¾

---

## ğŸ Story 4-4 å®Œæˆæ ‡å¿—

âœ… **Frontend**: WeekViewCalendar + ScheduleWeekView + Composable (~510 è¡Œ)
âœ… **åŠŸèƒ½**: å‘¨è§†å›¾ã€å¯¼èˆªã€å†²çªå¯è§†åŒ–ã€äº‹ä»¶è¯¦æƒ…
âœ… **UI/UX**: ç½‘æ ¼å¸ƒå±€ã€ä»Šå¤©é«˜äº®ã€äº¤äº’åé¦ˆ
âœ… **æ€§èƒ½**: CSS Grid + Computed ç¼“å­˜

**æ€»ä»£ç é‡**: ~510 è¡Œ
**æ€»æ–‡ä»¶æ•°**: 3 ä¸ªæ–‡ä»¶ï¼ˆ3 frontendï¼‰

---

**Story 4-4 çŠ¶æ€**: âœ… **COMPLETED**
**å®Œæˆåº¦**: 100%

